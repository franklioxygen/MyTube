
> backend@1.7.35 test
> vitest run


 RUN  v3.2.4 /Users/franklioxygen/Projects/mytube/backend

stdout | src/__tests__/controllers/cleanupController.test.ts > cleanupController > should delete directories starting with temp_ recursively
[2026-01-05 13:56:23.946] [DEBUG] Deleted temp directory: /Users/franklioxygen/Projects/mytube/backend/src/__tests__/temp_cleanup_test_videos_dir/normal_folder/temp_nested

stdout | src/__tests__/controllers/cleanupController.test.ts > cleanupController > should delete directories starting with temp_ recursively
[2026-01-05 13:56:23.957] [DEBUG] Deleted temp directory: /Users/franklioxygen/Projects/mytube/backend/src/__tests__/temp_cleanup_test_videos_dir/temp_folder1

stdout | src/__tests__/controllers/cleanupController.test.ts > cleanupController > should delete directories starting with temp_ recursively
[2026-01-05 13:56:23.957] [DEBUG] Deleted temp file: /Users/franklioxygen/Projects/mytube/backend/src/__tests__/temp_cleanup_test_videos_dir/video.mp4.part

 âœ“ src/__tests__/controllers/cleanupController.test.ts (1 test) 35ms
stdout | src/__tests__/services/storageService.test.ts > StorageService > initializeStorage > should ensure directories exist
[2026-01-05 13:56:24.313] [INFO] Cleared active downloads from database on startup
[2026-01-05 13:56:24.314] [INFO] Migrating database: Adding tags column to videos table...
[2026-01-05 13:56:24.314] [INFO] Migration successful.
[2026-01-05 13:56:24.314] [INFO] Migrating database: Adding view_count column to videos table...
[2026-01-05 13:56:24.314] [INFO] Migration successful: view_count added.
[2026-01-05 13:56:24.314] [INFO] Migrating database: Adding progress column to videos table...
[2026-01-05 13:56:24.314] [INFO] Migration successful: progress added.
[2026-01-05 13:56:24.314] [INFO] Migrating database: Adding duration column to videos table...
[2026-01-05 13:56:24.314] [INFO] Migration successful: duration added.
[2026-01-05 13:56:24.314] [INFO] Migrating database: Adding file_size column to videos table...
[2026-01-05 13:56:24.314] [INFO] Migration successful: file_size added.
[2026-01-05 13:56:24.314] [INFO] Migrating database: Adding last_played_at column to videos table...
[2026-01-05 13:56:24.314] [INFO] Migration successful: last_played_at added.
[2026-01-05 13:56:24.314] [INFO] Migrating database: Adding subtitles column to videos table...
[2026-01-05 13:56:24.314] [INFO] Migration successful: subtitles added.
[2026-01-05 13:56:24.314] [INFO] Migrating database: Adding description column to videos table...
[2026-01-05 13:56:24.314] [INFO] Migration successful: description added.
[2026-01-05 13:56:24.314] [INFO] Migrating database: Adding source_url column to downloads table...
[2026-01-05 13:56:24.314] [INFO] Migration successful: source_url added.
[2026-01-05 13:56:24.314] [INFO] Migrating database: Adding type column to downloads table...
[2026-01-05 13:56:24.314] [INFO] Migration successful: type added.
[2026-01-05 13:56:24.314] [INFO] Migrating database: Adding video_id column to download_history table...
[2026-01-05 13:56:24.314] [INFO] Migration successful: video_id added to download_history.
[2026-01-05 13:56:24.314] [INFO] Migrating database: Adding downloaded_at column to download_history table...
[2026-01-05 13:56:24.314] [INFO] Migration successful: downloaded_at added to download_history.
[2026-01-05 13:56:24.314] [INFO] Migrating database: Adding deleted_at column to download_history table...
[2026-01-05 13:56:24.314] [INFO] Migration successful: deleted_at added to download_history.

stdout | src/__tests__/services/storageService.test.ts > StorageService > initializeStorage > should create status.json if not exists
[2026-01-05 13:56:24.316] [INFO] Cleared active downloads from database on startup
[2026-01-05 13:56:24.316] [INFO] Migrating database: Adding tags column to videos table...
[2026-01-05 13:56:24.316] [INFO] Migration successful.
[2026-01-05 13:56:24.316] [INFO] Migrating database: Adding view_count column to videos table...
[2026-01-05 13:56:24.316] [INFO] Migration successful: view_count added.
[2026-01-05 13:56:24.316] [INFO] Migrating database: Adding progress column to videos table...
[2026-01-05 13:56:24.316] [INFO] Migration successful: progress added.
[2026-01-05 13:56:24.316] [INFO] Migrating database: Adding duration column to videos table...
[2026-01-05 13:56:24.316] [INFO] Migration successful: duration added.
[2026-01-05 13:56:24.316] [INFO] Migrating database: Adding file_size column to videos table...
[2026-01-05 13:56:24.316] [INFO] Migration successful: file_size added.
[2026-01-05 13:56:24.316] [INFO] Migrating database: Adding last_played_at column to videos table...
[2026-01-05 13:56:24.316] [INFO] Migration successful: last_played_at added.
[2026-01-05 13:56:24.316] [INFO] Migrating database: Adding subtitles column to videos table...
[2026-01-05 13:56:24.316] [INFO] Migration successful: subtitles added.
[2026-01-05 13:56:24.316] [INFO] Migrating database: Adding description column to videos table...
[2026-01-05 13:56:24.316] [INFO] Migration successful: description added.
[2026-01-05 13:56:24.316] [INFO] Migrating database: Adding source_url column to downloads table...
[2026-01-05 13:56:24.316] [INFO] Migration successful: source_url added.
[2026-01-05 13:56:24.316] [INFO] Migrating database: Adding type column to downloads table...
[2026-01-05 13:56:24.316] [INFO] Migration successful: type added.
[2026-01-05 13:56:24.316] [INFO] Migrating database: Adding video_id column to download_history table...
[2026-01-05 13:56:24.316] [INFO] Migration successful: video_id added to download_history.
[2026-01-05 13:56:24.316] [INFO] Migrating database: Adding downloaded_at column to download_history table...
[2026-01-05 13:56:24.316] [INFO] Migration successful: downloaded_at added to download_history.
[2026-01-05 13:56:24.316] [INFO] Migrating database: Adding deleted_at column to download_history table...
[2026-01-05 13:56:24.316] [INFO] Migration successful: deleted_at added to download_history.

stdout | src/__tests__/services/storageService.test.ts > StorageService > addActiveDownload > should insert active download
[2026-01-05 13:56:24.316] [INFO] Added/Updated active download: title (id)

stderr | src/__tests__/services/storageService.test.ts > StorageService > updateActiveDownload > should handle errors
[2026-01-05 13:56:24.317] [ERROR] Error updating active download Error: Update failed
    at Object.<anonymous> [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/services/storageService.test.ts:190:59[90m)[39m
    at Object.mockCall [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:96:15[90m)[39m
    at Object.spy [as update] [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4mtinyspy[24m/dist/index.js:47:80[90m)[39m
    at Module.updateActiveDownload [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/storageService/downloadStatus.ts:56:8[90m)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/services/storageService.test.ts:191:35
    at Proxy.assertThrows [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4mchai[24m/index.js:2767:5[90m)[39m
    at Proxy.methodWrapper [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4mchai[24m/index.js:1686:25[90m)[39m
    at Proxy.<anonymous> [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/expect[24m/dist/index.js:1088:12[90m)[39m
    at Proxy.overwritingMethodWrapper [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4mchai[24m/index.js:1735:33[90m)[39m
    at Proxy.<anonymous> [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/expect[24m/dist/index.js:1420:16[90m)[39m

stdout | src/__tests__/services/storageService.test.ts > StorageService > removeActiveDownload > should remove active download
[2026-01-05 13:56:24.324] [INFO] Removed active download: id

stderr | src/__tests__/services/storageService.test.ts > StorageService > removeActiveDownload > should handle errors
[2026-01-05 13:56:24.324] [ERROR] Error removing active download Error: Delete failed
    at Object.<anonymous> [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/services/storageService.test.ts:209:59[90m)[39m
    at Object.mockCall [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:96:15[90m)[39m
    at Object.spy [as delete] [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4mtinyspy[24m/dist/index.js:47:80[90m)[39m
    at Module.removeActiveDownload [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/storageService/downloadStatus.ts:65:8[90m)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/services/storageService.test.ts:210:35
    at Proxy.assertThrows [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4mchai[24m/index.js:2767:5[90m)[39m
    at Proxy.methodWrapper [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4mchai[24m/index.js:1686:25[90m)[39m
    at Proxy.<anonymous> [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/expect[24m/dist/index.js:1088:12[90m)[39m
    at Proxy.overwritingMethodWrapper [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4mchai[24m/index.js:1735:33[90m)[39m
    at Proxy.<anonymous> [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/expect[24m/dist/index.js:1420:16[90m)[39m

stderr | src/__tests__/services/storageService.test.ts > StorageService > setQueuedDownloads > should handle errors
[2026-01-05 13:56:24.325] [ERROR] Error setting queued downloads Error: Transaction failed
    at Object.<anonymous> [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/services/storageService.test.ts:235:64[90m)[39m
    at Object.mockCall [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:96:15[90m)[39m
    at Object.spy [as transaction] [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4mtinyspy[24m/dist/index.js:47:80[90m)[39m
    at Module.setQueuedDownloads [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/storageService/downloadStatus.ts:76:8[90m)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/services/storageService.test.ts:236:35
    at Proxy.assertThrows [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4mchai[24m/index.js:2767:5[90m)[39m
    at Proxy.methodWrapper [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4mchai[24m/index.js:1686:25[90m)[39m
    at Proxy.<anonymous> [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/expect[24m/dist/index.js:1088:12[90m)[39m
    at Proxy.overwritingMethodWrapper [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4mchai[24m/index.js:1735:33[90m)[39m
    at Proxy.<anonymous> [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/expect[24m/dist/index.js:1420:16[90m)[39m

stdout | src/__tests__/services/storageService.test.ts > StorageService > deleteVideo > should delete video and files
[2026-01-05 13:56:24.331] [INFO] Marked video download as deleted: 1

stderr | src/__tests__/services/storageService.test.ts > StorageService > deleteCollectionWithFiles > should delete collection and files
[2026-01-05 13:56:24.335] [ERROR] Error getting settings TypeError: __vite_ssr_import_0__.db.select(...).from(...).all is not a function
    at getSettings [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/storageService/settings.ts:8:52[90m)[39m
    at moveThumbnailFromCollection [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/storageService/collectionFileManager.ts:182:22[90m)[39m
    at moveAllFilesFromCollection [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/storageService/collectionFileManager.ts:420:27[90m)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/storageService/collections.ts:191:25
    at Array.forEach (<anonymous>)
    at Module.deleteCollectionWithFiles [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/storageService/collections.ts:187:23[90m)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/services/storageService.test.ts:645:22
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20

stdout | src/__tests__/services/storageService.test.ts > StorageService > deleteCollectionAndVideos > should delete collection and all videos
[2026-01-05 13:56:24.337] [INFO] Marked video download as deleted: v1

stdout | src/services/storageService/__tests__/collections.test.ts > collectionsService > generateUniqueCollectionName > should append number if name exists
[2026-01-05 13:56:24.337] [INFO] Collection name "My Col" already exists, using "My Col (3)" instead

 âœ“ src/__tests__/services/storageService.test.ts (29 tests) 28ms
 âœ“ src/services/storageService/__tests__/collections.test.ts (5 tests) 4ms
stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > uploadVideo > should upload video file when path exists
[2026-01-05 13:56:24.416] [DEBUG] resolveAbsolutePath input: /videos/test.mp4
[2026-01-05 13:56:24.417] [DEBUG] cleanRelative: videos/test.mp4
[2026-01-05 13:56:24.417] [DEBUG] uploadsBase: /Users/franklioxygen/Projects/mytube/backend/uploads
[2026-01-05 13:56:24.417] [DEBUG] Trying uploads videos path: /Users/franklioxygen/Projects/mytube/backend/uploads/videos/test.mp4
[2026-01-05 13:56:24.417] [DEBUG] Found video file at: /Users/franklioxygen/Projects/mytube/backend/uploads/videos/test.mp4

stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > uploadVideo > should upload video file when path exists
[2026-01-05 13:56:24.417] [DEBUG] [CloudStorage] Destination path in header: /uploads/test.mp4

stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > uploadVideo > should upload video file when path exists
[2026-01-05 13:56:24.417] [DEBUG] [CloudStorage] Destination path in header: /uploads/test_video.json

stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > uploadVideo > should upload thumbnail when path exists
[2026-01-05 13:56:24.418] [DEBUG] resolveAbsolutePath input: /images/thumb.jpg
[2026-01-05 13:56:24.418] [DEBUG] cleanRelative: images/thumb.jpg
[2026-01-05 13:56:24.418] [DEBUG] uploadsBase: /Users/franklioxygen/Projects/mytube/backend/uploads
[2026-01-05 13:56:24.418] [DEBUG] Trying uploads images path: /Users/franklioxygen/Projects/mytube/backend/uploads/images/thumb.jpg
[2026-01-05 13:56:24.418] [DEBUG] Found image file at: /Users/franklioxygen/Projects/mytube/backend/uploads/images/thumb.jpg

stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > uploadVideo > should upload thumbnail when path exists
[2026-01-05 13:56:24.418] [DEBUG] [CloudStorage] Destination path in header: /uploads/thumb.jpg

stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > uploadVideo > should upload thumbnail when path exists
[2026-01-05 13:56:24.418] [DEBUG] [CloudStorage] Destination path in header: /uploads/test_video.json

stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > uploadVideo > should upload metadata JSON file
[2026-01-05 13:56:24.418] [DEBUG] [CloudStorage] Destination path in header: /uploads/test_video.json

stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > uploadVideo > should handle missing video file gracefully
[2026-01-05 13:56:24.419] [DEBUG] resolveAbsolutePath input: /videos/missing.mp4
[2026-01-05 13:56:24.419] [DEBUG] cleanRelative: videos/missing.mp4
[2026-01-05 13:56:24.419] [DEBUG] uploadsBase: /Users/franklioxygen/Projects/mytube/backend/uploads
[2026-01-05 13:56:24.419] [DEBUG] Trying uploads videos path: /Users/franklioxygen/Projects/mytube/backend/uploads/videos/missing.mp4
[2026-01-05 13:56:24.419] [DEBUG] Video path does not exist: /Users/franklioxygen/Projects/mytube/backend/uploads/videos/missing.mp4
[2026-01-05 13:56:24.419] [DEBUG] Checking data root: /Users/franklioxygen/Projects/mytube/backend/data
[2026-01-05 13:56:24.419] [DEBUG] Found data root directory, trying file: /Users/franklioxygen/Projects/mytube/backend/data/videos/missing.mp4
[2026-01-05 13:56:24.419] [DEBUG] File not found in data root: /Users/franklioxygen/Projects/mytube/backend/data/videos/missing.mp4
[2026-01-05 13:56:24.419] [DEBUG] Checking data root: /Users/franklioxygen/Projects/mytube/data
[2026-01-05 13:56:24.419] [DEBUG] Found data root directory, trying file: /Users/franklioxygen/Projects/mytube/data/videos/missing.mp4
[2026-01-05 13:56:24.419] [DEBUG] File not found in data root: /Users/franklioxygen/Projects/mytube/data/videos/missing.mp4
[2026-01-05 13:56:24.419] [DEBUG] Checking data root: /Users/franklioxygen/Projects/mytube/backend/data
[2026-01-05 13:56:24.419] [DEBUG] Found data root directory, trying file: /Users/franklioxygen/Projects/mytube/backend/data/videos/missing.mp4
[2026-01-05 13:56:24.419] [DEBUG] File not found in data root: /Users/franklioxygen/Projects/mytube/backend/data/videos/missing.mp4
[2026-01-05 13:56:24.419] [DEBUG] No matching absolute path found for: /videos/missing.mp4

stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > uploadVideo > should handle missing video file gracefully
[2026-01-05 13:56:24.419] [DEBUG] [CloudStorage] Destination path in header: /uploads/test_video.json

stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > uploadVideo > should handle upload errors gracefully
[2026-01-05 13:56:24.419] [DEBUG] resolveAbsolutePath input: /videos/test.mp4
[2026-01-05 13:56:24.419] [DEBUG] cleanRelative: videos/test.mp4
[2026-01-05 13:56:24.419] [DEBUG] uploadsBase: /Users/franklioxygen/Projects/mytube/backend/uploads
[2026-01-05 13:56:24.419] [DEBUG] Trying uploads videos path: /Users/franklioxygen/Projects/mytube/backend/uploads/videos/test.mp4
[2026-01-05 13:56:24.419] [DEBUG] Found video file at: /Users/franklioxygen/Projects/mytube/backend/uploads/videos/test.mp4

stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > uploadVideo > should handle upload errors gracefully
[2026-01-05 13:56:24.420] [DEBUG] [CloudStorage] Destination path in header: /uploads/test.mp4

stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > uploadVideo > should sanitize filename for metadata
[2026-01-05 13:56:24.420] [DEBUG] [CloudStorage] Destination path in header: /uploads/test_video__2024_.json

stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > uploadFile error handling > should throw NetworkError on HTTP error response
[2026-01-05 13:56:24.420] [DEBUG] resolveAbsolutePath input: /videos/test.mp4
[2026-01-05 13:56:24.420] [DEBUG] cleanRelative: videos/test.mp4
[2026-01-05 13:56:24.420] [DEBUG] uploadsBase: /Users/franklioxygen/Projects/mytube/backend/uploads
[2026-01-05 13:56:24.420] [DEBUG] Trying uploads videos path: /Users/franklioxygen/Projects/mytube/backend/uploads/videos/test.mp4
[2026-01-05 13:56:24.420] [DEBUG] Found video file at: /Users/franklioxygen/Projects/mytube/backend/uploads/videos/test.mp4

stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > uploadFile error handling > should throw NetworkError on HTTP error response
[2026-01-05 13:56:24.420] [DEBUG] [CloudStorage] Destination path in header: /uploads/test.mp4

stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > uploadFile error handling > should handle network timeout errors
[2026-01-05 13:56:24.421] [DEBUG] resolveAbsolutePath input: /videos/test.mp4
[2026-01-05 13:56:24.421] [DEBUG] cleanRelative: videos/test.mp4
[2026-01-05 13:56:24.421] [DEBUG] uploadsBase: /Users/franklioxygen/Projects/mytube/backend/uploads
[2026-01-05 13:56:24.421] [DEBUG] Trying uploads videos path: /Users/franklioxygen/Projects/mytube/backend/uploads/videos/test.mp4
[2026-01-05 13:56:24.421] [DEBUG] Found video file at: /Users/franklioxygen/Projects/mytube/backend/uploads/videos/test.mp4

stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > uploadFile error handling > should handle network timeout errors
[2026-01-05 13:56:24.421] [DEBUG] [CloudStorage] Destination path in header: /uploads/test.mp4

stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > uploadFile error handling > should handle file not found errors
[2026-01-05 13:56:24.421] [DEBUG] resolveAbsolutePath input: /videos/test.mp4
[2026-01-05 13:56:24.421] [DEBUG] cleanRelative: videos/test.mp4
[2026-01-05 13:56:24.421] [DEBUG] uploadsBase: /Users/franklioxygen/Projects/mytube/backend/uploads
[2026-01-05 13:56:24.421] [DEBUG] Trying uploads videos path: /Users/franklioxygen/Projects/mytube/backend/uploads/videos/test.mp4
[2026-01-05 13:56:24.421] [DEBUG] Found video file at: /Users/franklioxygen/Projects/mytube/backend/uploads/videos/test.mp4

stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > uploadFile error handling > should handle file not found errors
[2026-01-05 13:56:24.421] [DEBUG] [CloudStorage] Destination path in header: /uploads/test.mp4

stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > getSignedUrl > should coalesce multiple requests for the same file
[2026-01-05 13:56:24.421] [DEBUG] [CloudStorage] Cleared all signed URL caches
[2026-01-05 13:56:24.421] [DEBUG] [CloudStorage] Cleared all file list caches
[2026-01-05 13:56:24.422] [DEBUG] [CloudStorage] Joining inflight request for test.mp4 (video)
[2026-01-05 13:56:24.422] [DEBUG] [CloudStorage] Joining inflight request for test.mp4 (video)

stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > getSignedUrl > should coalesce multiple requests for the same file
[2026-01-05 13:56:24.472] [DEBUG] [CloudStorage] Cached file list for path: /uploads

stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > getSignedUrl > should coalesce multiple requests for the same file
[2026-01-05 13:56:24.472] [DEBUG] [CloudStorage] Cached signed URL for test.mp4 (video)

stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > getSignedUrl > should cache results
[2026-01-05 13:56:24.474] [DEBUG] [CloudStorage] Cleared all signed URL caches
[2026-01-05 13:56:24.474] [DEBUG] [CloudStorage] Cleared all file list caches

stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > getSignedUrl > should cache results
[2026-01-05 13:56:24.474] [DEBUG] [CloudStorage] Cached file list for path: /uploads

stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > getSignedUrl > should cache results
[2026-01-05 13:56:24.475] [DEBUG] [CloudStorage] Cached signed URL for test.mp4 (video)

stdout | src/__tests__/services/CloudStorageService.test.ts > CloudStorageService > getSignedUrl > should cache results
[2026-01-05 13:56:24.475] [DEBUG] [CloudStorage] Using cached signed URL for test.mp4 (video)

 âœ“ src/__tests__/services/CloudStorageService.test.ts (14 tests) 64ms
stdout | src/__tests__/services/downloadManager.test.ts > DownloadManager > addDownload > should add download to queue and process it
Starting download: Test Video (id1)

stdout | src/__tests__/services/downloadManager.test.ts > DownloadManager > addDownload > should add download to queue and process it
Download finished for Test Video. Result title: undefined

stderr | src/__tests__/services/downloadManager.test.ts > DownloadManager > addDownload > should add download to queue and process it
Background cloud upload failed: TypeError: Cannot read properties of undefined (reading 'cloudDriveScanPaths')
    at getConfig [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/cloudStorage/config.ts:16:16[90m)[39m
    at CloudStorageService.uploadVideo [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/cloudStorage/index.ts:20:20[90m)[39m
    at DownloadManager.processQueue [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/downloadManager.ts:382:27[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m

 âœ“ src/__tests__/services/continuousDownloadService.test.ts (4 tests) 336ms
   âœ“ ContinuousDownloadService > cancelTask > should cancel existing task  333ms
stdout | src/__tests__/services/downloadManager.test.ts > DownloadManager > addDownload > should handle download failures
Starting download: Test Video (id1)

stderr | src/__tests__/services/downloadManager.test.ts > DownloadManager > addDownload > should handle download failures
Error downloading Test Video: Error: Download failed
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/services/downloadManager.test.ts:78:56
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at runSuite [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

stdout | src/__tests__/services/subscriptionService.test.ts > SubscriptionService > subscribe > should subscribe to a YouTube channel
Executing: yt-dlp --dump-single-json --no-warnings --no-warnings --flat-playlist --playlist-end 1 --cookies /Users/franklioxygen/Projects/mytube/backend/data/cookies.txt --js-runtime node https://www.youtube.com/@testuser/videos

stderr | src/__tests__/services/subscriptionService.test.ts > SubscriptionService > subscribe > should subscribe to a YouTube channel
Error reading user yt-dlp config: TypeError: Cannot read properties of undefined (reading 'ytDlpConfig')
    at getUserYtDlpConfig [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/utils/ytDlpUtils.ts:426:33[90m)[39m
    at SubscriptionService.subscribe [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/subscriptionService.ts:85:30[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/services/subscriptionService.test.ts:88:22
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

stdout | src/__tests__/services/downloadManager.test.ts > DownloadManager > addDownload > should queue downloads when at max concurrent limit
Starting download: Video 0 (id0)
Starting download: Video 1 (id1)
Starting download: Video 2 (id2)

stdout | src/__tests__/utils/cleanupVideoArtifacts.test.ts > cleanupVideoArtifacts > should remove .part files
Deleted artifact file: /Users/franklioxygen/Projects/mytube/backend/src/__tests__/utils/temp_cleanup_artifacts_test/video_123.mp4.part

stdout | src/services/cloudStorage/__tests__/cloudThumbnailCache.test.ts > cloudThumbnailCache > getCachedThumbnail > should return null if file does not exist
[2026-01-05 13:56:24.843] [DEBUG] [CloudThumbnailCache] Cache miss for cloud:movies/test.mp4

stdout | src/services/cloudStorage/__tests__/cloudThumbnailCache.test.ts > cloudThumbnailCache > getCachedThumbnail > should return path if file exists
[2026-01-05 13:56:24.844] [DEBUG] [CloudThumbnailCache] Cache hit for cloud:movies/test.mp4

stdout | src/services/cloudStorage/__tests__/cloudThumbnailCache.test.ts > cloudThumbnailCache > saveThumbnailToCache > should write buffer to file
[2026-01-05 13:56:24.846] [DEBUG] [CloudThumbnailCache] Cached thumbnail for cloud:movies/test.mp4

stdout | src/services/cloudStorage/__tests__/cloudThumbnailCache.test.ts > cloudThumbnailCache > saveThumbnailToCache > should copy file if input is string path
[2026-01-05 13:56:24.847] [DEBUG] [CloudThumbnailCache] Cached thumbnail for cloud:movies/test.mp4

stdout | src/services/cloudStorage/__tests__/cloudThumbnailCache.test.ts > cloudThumbnailCache > downloadAndCacheThumbnail > should return existing cache path if already cached
[2026-01-05 13:56:24.848] [DEBUG] [CloudThumbnailCache] Cache hit for cloud:movies/test.mp4
[2026-01-05 13:56:24.848] [DEBUG] [CloudThumbnailCache] Thumbnail was cached while downloading: cloud:movies/test.mp4

stdout | src/services/cloudStorage/__tests__/cloudThumbnailCache.test.ts > cloudThumbnailCache > downloadAndCacheThumbnail > should download and save thumbnail
[2026-01-05 13:56:24.848] [DEBUG] [CloudThumbnailCache] Cache miss for cloud:movies/test.mp4
[2026-01-05 13:56:24.848] [DEBUG] [CloudThumbnailCache] Downloading thumbnail from cloud: cloud:movies/test.mp4

stdout | src/services/cloudStorage/__tests__/cloudThumbnailCache.test.ts > cloudThumbnailCache > downloadAndCacheThumbnail > should download and save thumbnail
[2026-01-05 13:56:24.848] [INFO] [CloudThumbnailCache] Successfully downloaded and cached thumbnail for cloud:movies/test.mp4

stdout | src/services/cloudStorage/__tests__/cloudThumbnailCache.test.ts > cloudThumbnailCache > downloadAndCacheThumbnail > should return null on download failure
[2026-01-05 13:56:24.849] [DEBUG] [CloudThumbnailCache] Cache miss for cloud:movies/test.mp4
[2026-01-05 13:56:24.849] [DEBUG] [CloudThumbnailCache] Downloading thumbnail from cloud: cloud:movies/test.mp4

stderr | src/services/cloudStorage/__tests__/cloudThumbnailCache.test.ts > cloudThumbnailCache > downloadAndCacheThumbnail > should return null on download failure
[2026-01-05 13:56:24.849] [ERROR] [CloudThumbnailCache] Failed to download and cache thumbnail for cloud:movies/test.mp4: Error: Network Error
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/cloudStorage/__tests__/cloudThumbnailCache.test.ts:114:48
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at runSuite [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

stdout | src/services/cloudStorage/__tests__/cloudThumbnailCache.test.ts > cloudThumbnailCache > downloadAndCacheThumbnail > should return null on empty response
[2026-01-05 13:56:24.852] [DEBUG] [CloudThumbnailCache] Cache miss for cloud:movies/test.mp4
[2026-01-05 13:56:24.852] [DEBUG] [CloudThumbnailCache] Downloading thumbnail from cloud: cloud:movies/test.mp4

stderr | src/services/cloudStorage/__tests__/cloudThumbnailCache.test.ts > cloudThumbnailCache > downloadAndCacheThumbnail > should return null on empty response
[2026-01-05 13:56:24.852] [ERROR] [CloudThumbnailCache] Empty response when downloading thumbnail for cloud:movies/test.mp4

stdout | src/services/cloudStorage/__tests__/cloudThumbnailCache.test.ts > cloudThumbnailCache > clearThumbnailCache > should clear specific file if cloud path provided
[2026-01-05 13:56:24.852] [DEBUG] [CloudThumbnailCache] Cleared cache for cloud:movies/test.mp4

stdout | src/services/cloudStorage/__tests__/cloudThumbnailCache.test.ts > cloudThumbnailCache > clearThumbnailCache > should clear all files if no path provided
[2026-01-05 13:56:24.852] [DEBUG] [CloudThumbnailCache] Cleared all cache

 âœ“ src/services/cloudStorage/__tests__/cloudThumbnailCache.test.ts (16 tests) 13ms
 âœ“ src/services/storageService/__tests__/videoDownloadTracking.test.ts (5 tests) 3ms
stdout | src/__tests__/services/downloadManager.test.ts > DownloadManager > addDownload > should queue downloads when at max concurrent limit
Download finished for Video 0. Result title: undefined

stderr | src/__tests__/services/downloadManager.test.ts > DownloadManager > addDownload > should queue downloads when at max concurrent limit
Background cloud upload failed: TypeError: Cannot read properties of undefined (reading 'cloudDriveScanPaths')
    at getConfig [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/cloudStorage/config.ts:16:16[90m)[39m
    at CloudStorageService.uploadVideo [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/cloudStorage/index.ts:20:20[90m)[39m
    at DownloadManager.processQueue [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/downloadManager.ts:382:27[90m)[39m
[90m    at runNextTicks (node:internal/process/task_queues:64:5)[39m
[90m    at listOnTimeout (node:internal/timers:567:9)[39m
[90m    at processTimers (node:internal/timers:541:7)[39m

stdout | src/__tests__/services/downloadManager.test.ts > DownloadManager > addDownload > should queue downloads when at max concurrent limit
Starting download: Video 3 (id3)

stdout | src/__tests__/services/downloadManager.test.ts > DownloadManager > addDownload > should queue downloads when at max concurrent limit
Download finished for Video 1. Result title: undefined

stderr | src/__tests__/services/downloadManager.test.ts > DownloadManager > addDownload > should queue downloads when at max concurrent limit
Background cloud upload failed: TypeError: Cannot read properties of undefined (reading 'cloudDriveScanPaths')
    at getConfig [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/cloudStorage/config.ts:16:16[90m)[39m
    at CloudStorageService.uploadVideo [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/cloudStorage/index.ts:20:20[90m)[39m
    at DownloadManager.processQueue [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/downloadManager.ts:382:27[90m)[39m
[90m    at runNextTicks (node:internal/process/task_queues:64:5)[39m
[90m    at listOnTimeout (node:internal/timers:567:9)[39m
[90m    at processTimers (node:internal/timers:541:7)[39m

stdout | src/__tests__/services/downloadManager.test.ts > DownloadManager > addDownload > should queue downloads when at max concurrent limit
Download finished for Video 2. Result title: undefined

stderr | src/__tests__/services/downloadManager.test.ts > DownloadManager > addDownload > should queue downloads when at max concurrent limit
Background cloud upload failed: TypeError: Cannot read properties of undefined (reading 'cloudDriveScanPaths')
    at getConfig [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/cloudStorage/config.ts:16:16[90m)[39m
    at CloudStorageService.uploadVideo [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/cloudStorage/index.ts:20:20[90m)[39m
    at DownloadManager.processQueue [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/downloadManager.ts:382:27[90m)[39m

stdout | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should use H.264 compatible format for YouTube videos by default
[2026-01-05 13:56:24.921] [INFO] Detected URL: https://www.youtube.com/watch?v=123456

stdout | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should use H.264 compatible format for YouTube videos by default
[2026-01-05 13:56:24.922] [INFO] Video info: {
  title: [32m'Test Video'[39m,
  uploader: [32m'Test Author'[39m,
  upload_date: [32m'20230101'[39m,
  extractor: [32m'youtube'[39m
}

stderr | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should use H.264 compatible format for YouTube videos by default
[2026-01-05 13:56:24.923] [WARN] Proxy not found in download flags. User config proxy: [90mundefined[39m

stdout | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should use H.264 compatible format for YouTube videos by default
[2026-01-05 13:56:24.923] [INFO] File location settings: {
  moveThumbnailsToVideoFolder: [33mfalse[39m,
  moveSubtitlesToVideoFolder: [33mfalse[39m,
  videoDir: [32m'/Users/franklioxygen/Projects/mytube/backend/uploads/videos'[39m,
  imageDir: [32m'/Users/franklioxygen/Projects/mytube/backend/uploads/images'[39m
}
[2026-01-05 13:56:24.923] [INFO] Preparing video download path: /Users/franklioxygen/Projects/mytube/backend/uploads/videos/Test.Video-Test.Author-2023.mp4
[2026-01-05 13:56:24.923] [DEBUG] Final yt-dlp flags: {
  output: [32m'/Users/franklioxygen/Projects/mytube/backend/uploads/videos/Test.Video-Test.Author-2023.mp4'[39m,
  format: [32m'bestvideo[ext=mp4][vcodec^=avc1]+bestaudio[ext=m4a]/bestvideo[ext=mp4][vcodec^=h264]+bestaudio[ext=m4a]/best[ext=mp4]/best'[39m,
  mergeOutputFormat: [32m'mp4'[39m,
  writeSubs: [33mtrue[39m,
  writeAutoSubs: [33mtrue[39m,
  convertSubs: [32m'vtt'[39m
}
[2026-01-05 13:56:24.923] [INFO] Using merge output format: mp4, downloading to: /Users/franklioxygen/Projects/mytube/backend/uploads/videos/Test.Video-Test.Author-2023.mp4

stdout | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should use H.264 compatible format for YouTube videos by default
[2026-01-05 13:56:24.924] [INFO] Video downloaded successfully
[2026-01-05 13:56:24.924] [INFO] Downloading thumbnail from: http://example.com/thumb.jpg

stdout | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should use H.264 compatible format for YouTube videos by default
[2026-01-05 13:56:24.924] [INFO] Thumbnail saved to: /Users/franklioxygen/Projects/mytube/backend/uploads/images/Test.Video-Test.Author-2023.jpg

stdout | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should use H.264 compatible format for YouTube videos by default
[2026-01-05 13:56:24.924] [INFO] Processing subtitles for Test.Video-Test.Author-2023, move to video folder: false
[2026-01-05 13:56:24.924] [INFO] Found 0 subtitle files

stdout | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should use H.264 compatible format for YouTube videos by default
[2026-01-05 13:56:24.924] [INFO] Video added to database

stdout | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should relax H.264 preference when formatSort is provided to allow higher resolutions
[2026-01-05 13:56:24.925] [INFO] Detected URL: https://www.youtube.com/watch?v=123456

stdout | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should relax H.264 preference when formatSort is provided to allow higher resolutions
[2026-01-05 13:56:24.925] [INFO] Video info: {
  title: [32m'Test Video'[39m,
  uploader: [32m'Test Author'[39m,
  upload_date: [32m'20230101'[39m,
  extractor: [32m'youtube'[39m
}

stdout | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should relax H.264 preference when formatSort is provided to allow higher resolutions
[2026-01-05 13:56:24.925] [INFO] File location settings: {
  moveThumbnailsToVideoFolder: [33mfalse[39m,
  moveSubtitlesToVideoFolder: [33mfalse[39m,
  videoDir: [32m'/Users/franklioxygen/Projects/mytube/backend/uploads/videos'[39m,
  imageDir: [32m'/Users/franklioxygen/Projects/mytube/backend/uploads/images'[39m
}
[2026-01-05 13:56:24.925] [INFO] Preparing video download path: /Users/franklioxygen/Projects/mytube/backend/uploads/videos/Test.Video-Test.Author-2023.mp4
[2026-01-05 13:56:24.925] [INFO] Using user-specified format sort: res:2160
[2026-01-05 13:56:24.925] [DEBUG] Final yt-dlp flags: {
  output: [32m'/Users/franklioxygen/Projects/mytube/backend/uploads/videos/Test.Video-Test.Author-2023.mp4'[39m,
  format: [32m'bestvideo[vcodec^=vp9][ext=webm]+bestaudio/bestvideo[ext=webm]+bestaudio/bestvideo+bestaudio/best'[39m,
  mergeOutputFormat: [32m'webm'[39m,
  writeSubs: [33mtrue[39m,
  writeAutoSubs: [33mtrue[39m,
  convertSubs: [32m'vtt'[39m,
  formatSort: [32m'res:2160'[39m
}
[2026-01-05 13:56:24.925] [INFO] Using merge output format: webm, downloading to: /Users/franklioxygen/Projects/mytube/backend/uploads/videos/Test.Video-Test.Author-2023.webm

stderr | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should relax H.264 preference when formatSort is provided to allow higher resolutions
[2026-01-05 13:56:24.925] [WARN] Proxy not found in download flags. User config proxy: [90mundefined[39m

stdout | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should relax H.264 preference when formatSort is provided to allow higher resolutions
[2026-01-05 13:56:24.925] [INFO] Video downloaded successfully
[2026-01-05 13:56:24.925] [INFO] Downloading thumbnail from: http://example.com/thumb.jpg

stdout | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should relax H.264 preference when formatSort is provided to allow higher resolutions
[2026-01-05 13:56:24.925] [INFO] Thumbnail saved to: /Users/franklioxygen/Projects/mytube/backend/uploads/images/Test.Video-Test.Author-2023.jpg

stdout | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should relax H.264 preference when formatSort is provided to allow higher resolutions
[2026-01-05 13:56:24.927] [INFO] Thumbnail saved to: /Users/franklioxygen/Projects/mytube/backend/uploads/images/Test.Video-Test.Author-2023.jpg

stdout | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should relax H.264 preference when formatSort is provided to allow higher resolutions
[2026-01-05 13:56:24.927] [INFO] Processing subtitles for Test.Video-Test.Author-2023, move to video folder: false
[2026-01-05 13:56:24.927] [INFO] Found 0 subtitle files

stdout | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should relax H.264 preference when formatSort is provided to allow higher resolutions
[2026-01-05 13:56:24.927] [INFO] Video added to database

stdout | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should NOT force generic avc1 string if user provides custom format
[2026-01-05 13:56:24.928] [INFO] Detected URL: https://www.youtube.com/watch?v=123456

stdout | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should NOT force generic avc1 string if user provides custom format
[2026-01-05 13:56:24.928] [INFO] Video info: {
  title: [32m'Test Video'[39m,
  uploader: [32m'Test Author'[39m,
  upload_date: [32m'20230101'[39m,
  extractor: [32m'youtube'[39m
}

stdout | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should NOT force generic avc1 string if user provides custom format
[2026-01-05 13:56:24.928] [INFO] File location settings: {
  moveThumbnailsToVideoFolder: [33mfalse[39m,
  moveSubtitlesToVideoFolder: [33mfalse[39m,
  videoDir: [32m'/Users/franklioxygen/Projects/mytube/backend/uploads/videos'[39m,
  imageDir: [32m'/Users/franklioxygen/Projects/mytube/backend/uploads/images'[39m
}
[2026-01-05 13:56:24.928] [INFO] Preparing video download path: /Users/franklioxygen/Projects/mytube/backend/uploads/videos/Test.Video-Test.Author-2023.mp4
[2026-01-05 13:56:24.928] [INFO] Using user-specified format: bestvideo+bestaudio
[2026-01-05 13:56:24.928] [DEBUG] Final yt-dlp flags: {
  output: [32m'/Users/franklioxygen/Projects/mytube/backend/uploads/videos/Test.Video-Test.Author-2023.mp4'[39m,
  format: [32m'bestvideo+bestaudio'[39m,
  mergeOutputFormat: [32m'mp4'[39m,
  writeSubs: [33mtrue[39m,
  writeAutoSubs: [33mtrue[39m,
  convertSubs: [32m'vtt'[39m
}
[2026-01-05 13:56:24.928] [INFO] Using merge output format: mp4, downloading to: /Users/franklioxygen/Projects/mytube/backend/uploads/videos/Test.Video-Test.Author-2023.mp4

stderr | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should NOT force generic avc1 string if user provides custom format
[2026-01-05 13:56:24.928] [WARN] Proxy not found in download flags. User config proxy: [90mundefined[39m

stdout | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should NOT force generic avc1 string if user provides custom format
[2026-01-05 13:56:24.928] [INFO] Video downloaded successfully
[2026-01-05 13:56:24.928] [INFO] Downloading thumbnail from: http://example.com/thumb.jpg

stdout | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should NOT force generic avc1 string if user provides custom format
[2026-01-05 13:56:24.928] [INFO] Thumbnail saved to: /Users/franklioxygen/Projects/mytube/backend/uploads/images/Test.Video-Test.Author-2023.jpg

stdout | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should NOT force generic avc1 string if user provides custom format
[2026-01-05 13:56:24.929] [INFO] Thumbnail saved to: /Users/franklioxygen/Projects/mytube/backend/uploads/images/Test.Video-Test.Author-2023.jpg

stdout | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should NOT force generic avc1 string if user provides custom format
[2026-01-05 13:56:24.929] [INFO] Processing subtitles for Test.Video-Test.Author-2023, move to video folder: false
[2026-01-05 13:56:24.929] [INFO] Found 0 subtitle files

stdout | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts > YtDlpDownloader Safari Compatibility > should NOT force generic avc1 string if user provides custom format
[2026-01-05 13:56:24.929] [INFO] Video added to database

stdout | src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts
[2026-01-05 13:56:24.930] [INFO] Thumbnail saved to: /Users/franklioxygen/Projects/mytube/backend/uploads/images/Test.Video-Test.Author-2023.jpg

 âœ“ src/__tests__/services/downloaders/YtDlpDownloader.safari.test.ts (3 tests) 10ms
stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should queue download for valid URL
[2026-01-05 13:56:24.942] [INFO] Processing download request for input: https://youtube.com/watch?v=123

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should queue download for valid URL
[2026-01-05 13:56:24.943] [INFO] Processed URL: https://youtube.com/watch?v=123
[2026-01-05 13:56:24.943] [INFO] Resolved URL to: https://youtube.com/watch?v=123
[2026-01-05 13:56:24.943] [INFO] Fetching video info for title...

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should queue download for valid URL
[2026-01-05 13:56:24.943] [INFO] Download completed successfully: success

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should return 400 for invalid URL
[2026-01-05 13:56:24.945] [INFO] Processing download request for input: not-a-url

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should return 400 for invalid URL
[2026-01-05 13:56:24.945] [INFO] Processed URL: not-a-url

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should handle Bilibili collection download
[2026-01-05 13:56:24.945] [INFO] Processing download request for input: https://www.bilibili.com/video/BV1xx

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should handle Bilibili collection download
[2026-01-05 13:56:24.946] [INFO] Processed URL: https://www.bilibili.com/video/BV1xx
[2026-01-05 13:56:24.946] [INFO] Resolved URL to: https://www.bilibili.com/video/BV1xx
[2026-01-05 13:56:24.946] [INFO] Fetching video info for title...

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should handle Bilibili collection download
[2026-01-05 13:56:24.946] [INFO] Download completed successfully: success

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should handle Bilibili multi-part download
[2026-01-05 13:56:24.946] [INFO] Processing download request for input: https://www.bilibili.com/video/BV1xx

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should handle Bilibili multi-part download
[2026-01-05 13:56:24.946] [INFO] Processed URL: https://www.bilibili.com/video/BV1xx
[2026-01-05 13:56:24.946] [INFO] Resolved URL to: https://www.bilibili.com/video/BV1xx
[2026-01-05 13:56:24.946] [INFO] Fetching video info for title...

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should handle Bilibili multi-part download
[2026-01-05 13:56:24.946] [INFO] Download completed successfully: success

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should handle MissAV download
[2026-01-05 13:56:24.946] [INFO] Processing download request for input: https://missav.com/v1

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should handle MissAV download
[2026-01-05 13:56:24.946] [INFO] Processed URL: https://missav.com/v1
[2026-01-05 13:56:24.946] [INFO] Resolved URL to: https://missav.com/v1
[2026-01-05 13:56:24.946] [INFO] Fetching video info for title...

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should handle MissAV download
[2026-01-05 13:56:24.946] [INFO] Download completed successfully: success

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should handle Bilibili single part download when checkParts returns 1 video
[2026-01-05 13:56:24.947] [INFO] Processing download request for input: https://www.bilibili.com/video/BV1xx

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should handle Bilibili single part download when checkParts returns 1 video
[2026-01-05 13:56:24.947] [INFO] Processed URL: https://www.bilibili.com/video/BV1xx
[2026-01-05 13:56:24.947] [INFO] Resolved URL to: https://www.bilibili.com/video/BV1xx
[2026-01-05 13:56:24.947] [INFO] Fetching video info for title...

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should handle Bilibili single part download when checkParts returns 1 video
[2026-01-05 13:56:24.947] [INFO] Download completed successfully: success

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should handle Bilibili single part download failure
[2026-01-05 13:56:24.947] [INFO] Processing download request for input: https://www.bilibili.com/video/BV1xx

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should handle Bilibili single part download failure
[2026-01-05 13:56:24.947] [INFO] Processed URL: https://www.bilibili.com/video/BV1xx
[2026-01-05 13:56:24.947] [INFO] Resolved URL to: https://www.bilibili.com/video/BV1xx
[2026-01-05 13:56:24.947] [INFO] Fetching video info for title...

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should handle Bilibili single part download failure
[2026-01-05 13:56:24.947] [INFO] Download completed successfully: [90mundefined[39m

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should handle download task errors
[2026-01-05 13:56:24.947] [INFO] Processing download request for input: https://youtube.com/watch?v=123

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should handle download task errors
[2026-01-05 13:56:24.947] [INFO] Processed URL: https://youtube.com/watch?v=123
[2026-01-05 13:56:24.948] [INFO] Resolved URL to: https://youtube.com/watch?v=123
[2026-01-05 13:56:24.948] [INFO] Fetching video info for title...

stderr | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should handle download task errors
[2026-01-05 13:56:24.948] [ERROR] Error queuing download: Error: Queue error
    at Object.<anonymous> [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/controllers/videoController.test.ts:249:15[90m)[39m
    at Object.mockCall [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:96:15[90m)[39m
    at Object.addDownload [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4mtinyspy[24m/dist/index.js:47:80[90m)[39m
    at Module.downloadVideo [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/controllers/videoDownloadController.ts:467:8[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/controllers/videoController.test.ts:252:7
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should handle YouTube download
[2026-01-05 13:56:24.952] [INFO] Processing download request for input: https://www.youtube.com/watch?v=abc123

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should handle YouTube download
[2026-01-05 13:56:24.952] [INFO] Processed URL: https://www.youtube.com/watch?v=abc123
[2026-01-05 13:56:24.952] [INFO] Resolved URL to: https://www.youtube.com/watch?v=abc123
[2026-01-05 13:56:24.952] [INFO] Fetching video info for title...

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > downloadVideo > should handle YouTube download
[2026-01-05 13:56:24.952] [INFO] Download completed successfully: success

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > checkBilibiliParts > should check bilibili parts
Trimmed Bilibili URL from "https://www.bilibili.com/video/BV1xx" to "https://www.bilibili.com/video/BV1xx"

stdout | src/__tests__/controllers/videoController.test.ts > VideoController > checkBilibiliCollection > should check bilibili collection
Trimmed Bilibili URL from "https://www.bilibili.com/video/BV1xx" to "https://www.bilibili.com/video/BV1xx"

 âœ“ src/__tests__/controllers/videoController.test.ts (32 tests) 19ms
stdout | src/__tests__/services/downloadManager.test.ts > DownloadManager > addDownload > should queue downloads when at max concurrent limit
Download finished for Video 3. Result title: undefined

stderr | src/__tests__/services/downloadManager.test.ts > DownloadManager > addDownload > should queue downloads when at max concurrent limit
Background cloud upload failed: TypeError: Cannot read properties of undefined (reading 'cloudDriveScanPaths')
    at getConfig [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/cloudStorage/config.ts:16:16[90m)[39m
    at CloudStorageService.uploadVideo [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/cloudStorage/index.ts:20:20[90m)[39m
    at DownloadManager.processQueue [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/downloadManager.ts:382:27[90m)[39m

stdout | src/__tests__/services/downloaders/MissAVDownloader.test.ts > MissAVDownloader > getVideoInfo > should extract author from domain name
[2026-01-05 13:56:25.080] [INFO] Fetching page content for https://missav.com/test-video with Puppeteer...

stdout | src/__tests__/services/downloaders/MissAVDownloader.test.ts > MissAVDownloader > getVideoInfo > should extract author from domain name for 123av
[2026-01-05 13:56:25.085] [INFO] Fetching page content for https://123av.com/test-video with Puppeteer...

 âœ“ src/__tests__/services/downloaders/MissAVDownloader.test.ts (2 tests) 7ms
stdout | src/__tests__/services/downloadManager.test.ts > DownloadManager > setMaxConcurrentDownloads > should process queue when limit increases
Starting download: Test (id1)

stdout | src/__tests__/services/downloadManager.test.ts > DownloadManager > setMaxConcurrentDownloads > should process queue when limit increases
Download finished for Test. Result title: undefined

stderr | src/__tests__/services/downloadManager.test.ts > DownloadManager > setMaxConcurrentDownloads > should process queue when limit increases
Background cloud upload failed: TypeError: Cannot read properties of undefined (reading 'cloudDriveScanPaths')
    at getConfig [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/cloudStorage/config.ts:16:16[90m)[39m
    at CloudStorageService.uploadVideo [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/cloudStorage/index.ts:20:20[90m)[39m
    at DownloadManager.processQueue [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/downloadManager.ts:382:27[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m

 âœ“ src/__tests__/utils/security.test.ts (8 tests) 3ms
 âœ“ src/__tests__/controllers/databaseBackupController.test.ts (6 tests) 5ms
stdout | src/__tests__/utils/cleanupVideoArtifacts.test.ts > cleanupVideoArtifacts > should remove .ytdl files
Deleted artifact file: /Users/franklioxygen/Projects/mytube/backend/src/__tests__/utils/temp_cleanup_artifacts_test/video_123.mp4.ytdl

stdout | src/services/cloudStorage/__tests__/fileLister.test.ts > cloudStorage fileLister > getFileList > should return files from API
[2026-01-05 13:56:25.360] [DEBUG] [CloudStorage] Cleared all file list caches

stdout | src/services/cloudStorage/__tests__/fileLister.test.ts > cloudStorage fileLister > getFileList > should return files from API
[2026-01-05 13:56:25.361] [DEBUG] [CloudStorage] Cached file list for path: /uploads

stdout | src/services/cloudStorage/__tests__/fileLister.test.ts > cloudStorage fileLister > getFileList > should return empty list on API error
[2026-01-05 13:56:25.362] [DEBUG] [CloudStorage] Cleared all file list caches

stderr | src/services/cloudStorage/__tests__/fileLister.test.ts > cloudStorage fileLister > getFileList > should return empty list on API error
[2026-01-05 13:56:25.362] [ERROR] [CloudStorage] Failed to get file list: Error: API Error
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/cloudStorage/__tests__/fileLister.test.ts:43:53
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at runSuite [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

stdout | src/services/cloudStorage/__tests__/fileLister.test.ts > cloudStorage fileLister > getFileList > should return empty list if response code is not 200
[2026-01-05 13:56:25.365] [DEBUG] [CloudStorage] Cleared all file list caches

stderr | src/services/cloudStorage/__tests__/fileLister.test.ts > cloudStorage fileLister > getFileList > should return empty list if response code is not 200
[2026-01-05 13:56:25.365] [ERROR] [CloudStorage] Failed to get file list: {"code":500,"message":"Server Error"}

stdout | src/services/cloudStorage/__tests__/fileLister.test.ts > cloudStorage fileLister > getFileList > should cache results
[2026-01-05 13:56:25.365] [DEBUG] [CloudStorage] Cleared all file list caches

stdout | src/services/cloudStorage/__tests__/fileLister.test.ts > cloudStorage fileLister > getFileList > should cache results
[2026-01-05 13:56:25.365] [DEBUG] [CloudStorage] Cached file list for path: /uploads

stdout | src/services/cloudStorage/__tests__/fileLister.test.ts > cloudStorage fileLister > getFileList > should cache results
[2026-01-05 13:56:25.365] [DEBUG] [CloudStorage] Using cached file list for path: /uploads

stdout | src/services/cloudStorage/__tests__/fileLister.test.ts > cloudStorage fileLister > getFilesRecursively > should recursively fetch files from directories
[2026-01-05 13:56:25.366] [DEBUG] [CloudStorage] Cleared all file list caches

stdout | src/services/cloudStorage/__tests__/fileLister.test.ts > cloudStorage fileLister > getFilesRecursively > should recursively fetch files from directories
[2026-01-05 13:56:25.366] [DEBUG] [CloudStorage] Cached file list for path: /uploads

stdout | src/services/cloudStorage/__tests__/fileLister.test.ts > cloudStorage fileLister > getFilesRecursively > should recursively fetch files from directories
[2026-01-05 13:56:25.366] [DEBUG] [CloudStorage] Cached file list for path: /uploads/subdir

stdout | src/services/cloudStorage/__tests__/fileLister.test.ts > cloudStorage fileLister > getFilesRecursively > should return whatever it found locally if recursion fails
[2026-01-05 13:56:25.366] [DEBUG] [CloudStorage] Cleared all file list caches

stdout | src/services/cloudStorage/__tests__/fileLister.test.ts > cloudStorage fileLister > getFilesRecursively > should return whatever it found locally if recursion fails
[2026-01-05 13:56:25.366] [DEBUG] [CloudStorage] Cached file list for path: /uploads

stderr | src/services/cloudStorage/__tests__/fileLister.test.ts > cloudStorage fileLister > getFilesRecursively > should return whatever it found locally if recursion fails
[2026-01-05 13:56:25.366] [ERROR] [CloudStorage] Failed to get file list: Error: Recursion Error
    at wrap.<anonymous> [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/cloudStorage/__tests__/fileLister.test.ts:134:23[90m)[39m
    at wrap.mockCall [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:96:15[90m)[39m
    at wrap [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4mtinyspy[24m/dist/index.js:47:80[90m)[39m
    at getFileList [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/cloudStorage/fileLister.ts:43:34[90m)[39m
    at getFilesRecursively [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/cloudStorage/fileLister.ts:99:25[90m)[39m
    at Module.getFilesRecursively [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/cloudStorage/fileLister.ts:113:15[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/cloudStorage/__tests__/fileLister.test.ts:137:28
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

 âœ“ src/services/cloudStorage/__tests__/fileLister.test.ts (6 tests) 8ms
 âœ“ src/__tests__/services/downloadManager.test.ts (9 tests) 1134ms
   âœ“ DownloadManager > addDownload > should add download to queue and process it  353ms
stdout | src/__tests__/services/subtitleService.test.ts > SubtitleService > moveAllSubtitles > should move subtitles to video folders
Starting to move all subtitles. Target: Video Folders
Finished moving subtitles. Moved: 1, Errors: 0

stdout | src/__tests__/services/subtitleService.test.ts > SubtitleService > moveAllSubtitles > should move subtitles to central subtitles folder
Starting to move all subtitles. Target: Central Subtitles Folder
Finished moving subtitles. Moved: 1, Errors: 0

stdout | src/__tests__/services/subtitleService.test.ts > SubtitleService > moveAllSubtitles > should handle videos in collection folders
Starting to move all subtitles. Target: Video Folders
Finished moving subtitles. Moved: 1, Errors: 0

stdout | src/__tests__/services/subtitleService.test.ts > SubtitleService > moveAllSubtitles > should skip videos without subtitles
Starting to move all subtitles. Target: Video Folders
Finished moving subtitles. Moved: 0, Errors: 0

stdout | src/__tests__/services/subtitleService.test.ts > SubtitleService > moveAllSubtitles > should handle missing subtitle files gracefully
Starting to move all subtitles. Target: Video Folders
Finished moving subtitles. Moved: 0, Errors: 0

stderr | src/__tests__/services/subtitleService.test.ts > SubtitleService > moveAllSubtitles > should handle missing subtitle files gracefully
Subtitle file not found: /subtitles/missing.vtt or /test/subtitles/missing.vtt

stdout | src/__tests__/services/subtitleService.test.ts > SubtitleService > moveAllSubtitles > should handle FileError during move
Starting to move all subtitles. Target: Video Folders
Finished moving subtitles. Moved: 0, Errors: 1

stderr | src/__tests__/services/subtitleService.test.ts > SubtitleService > moveAllSubtitles > should handle FileError during move
Failed to move subtitle sub1.vtt: FileError: Move failed
    at Object.<anonymous> [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/services/subtitleService.test.ts:226:15[90m)[39m
    at Object.mockCall [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:96:15[90m)[39m
    at Object.moveSync [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4mtinyspy[24m/dist/index.js:47:80[90m)[39m
    at Module.moveAllSubtitles [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/subtitleService.ts:113:24[90m)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/services/subtitleService.test.ts:229:28
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m {
  type: [32m'file'[39m,
  recoverable: [33mfalse[39m,
  filePath: [32m'/test/path'[39m
}
File error: Move failed /test/path

stdout | src/__tests__/services/subtitleService.test.ts > SubtitleService > moveAllSubtitles > should handle generic errors during move
Starting to move all subtitles. Target: Video Folders
Finished moving subtitles. Moved: 0, Errors: 1

stderr | src/__tests__/services/subtitleService.test.ts > SubtitleService > moveAllSubtitles > should handle generic errors during move
Failed to move subtitle sub1.vtt: Error: Generic error
    at Object.<anonymous> [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/services/subtitleService.test.ts:254:15[90m)[39m
    at Object.mockCall [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:96:15[90m)[39m
    at Object.moveSync [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4mtinyspy[24m/dist/index.js:47:80[90m)[39m
    at Module.moveAllSubtitles [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/subtitleService.ts:113:24[90m)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/services/subtitleService.test.ts:257:28
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m

stdout | src/__tests__/services/subtitleService.test.ts > SubtitleService > moveAllSubtitles > should not move if already in correct location
Starting to move all subtitles. Target: Video Folders
Finished moving subtitles. Moved: 0, Errors: 0

stdout | src/__tests__/services/subtitleService.test.ts > SubtitleService > moveAllSubtitles > should update path even if file already in correct location but path is wrong
Starting to move all subtitles. Target: Video Folders
Finished moving subtitles. Moved: 0, Errors: 0

stderr | src/__tests__/services/subtitleService.test.ts > SubtitleService > moveAllSubtitles > should update path even if file already in correct location but path is wrong
Subtitle file not found: /subtitles/sub1.vtt or /test/subtitles/sub1.vtt

 âœ“ src/__tests__/services/subtitleService.test.ts (9 tests) 10ms
stdout | src/services/cloudStorage/__tests__/videoUploader.test.ts > cloudStorage videoUploader > should upload video, thumbnail and metadata
[2026-01-05 13:56:25.473] [INFO] [CloudStorage] Starting upload for video: Test Video

stdout | src/services/cloudStorage/__tests__/videoUploader.test.ts > cloudStorage videoUploader > should upload video, thumbnail and metadata
[2026-01-05 13:56:25.473] [INFO] [CloudStorage] Upload completed for: Test Video
[2026-01-05 13:56:25.473] [INFO] [CloudStorage] Deleting 2 local file(s) after successful upload...
[2026-01-05 13:56:25.473] [INFO] [CloudStorage] Deleted local file: /abs/videos/test.mp4
[2026-01-05 13:56:25.473] [INFO] [CloudStorage] Deleted local file: /abs/images/test.jpg
[2026-01-05 13:56:25.473] [INFO] [CloudStorage] Local file cleanup completed
[2026-01-05 13:56:25.473] [INFO] [CloudStorage] Updated video record video-123 with cloud storage indicators

stdout | src/services/cloudStorage/__tests__/videoUploader.test.ts > cloudStorage videoUploader > should handle skipped uploads (already exists)
[2026-01-05 13:56:25.476] [INFO] [CloudStorage] Starting upload for video: Test Video

stdout | src/services/cloudStorage/__tests__/videoUploader.test.ts > cloudStorage videoUploader > should handle skipped uploads (already exists)
[2026-01-05 13:56:25.476] [INFO] [CloudStorage] Upload completed for: Test Video
[2026-01-05 13:56:25.476] [INFO] [CloudStorage] Updated video record video-123 with cloud storage indicators

stdout | src/services/cloudStorage/__tests__/videoUploader.test.ts > cloudStorage videoUploader > should skip file if local file missing
[2026-01-05 13:56:25.476] [INFO] [CloudStorage] Starting upload for video: Test Video

stderr | src/services/cloudStorage/__tests__/videoUploader.test.ts > cloudStorage videoUploader > should skip file if local file missing
[2026-01-05 13:56:25.476] [ERROR] [CloudStorage] Video file not found: videos/test.mp4

stdout | src/services/cloudStorage/__tests__/videoUploader.test.ts > cloudStorage videoUploader > should skip file if local file missing
[2026-01-05 13:56:25.476] [INFO] [CloudStorage] Upload completed for: Test Video
[2026-01-05 13:56:25.476] [INFO] [CloudStorage] Deleting 1 local file(s) after successful upload...
[2026-01-05 13:56:25.476] [INFO] [CloudStorage] Deleted local file: /abs/images/test.jpg
[2026-01-05 13:56:25.476] [INFO] [CloudStorage] Local file cleanup completed
[2026-01-05 13:56:25.476] [INFO] [CloudStorage] Updated video record video-123 with cloud storage indicators

stdout | src/services/cloudStorage/__tests__/videoUploader.test.ts > cloudStorage videoUploader > should handle failures gracefully
[2026-01-05 13:56:25.476] [INFO] [CloudStorage] Starting upload for video: Test Video

stderr | src/services/cloudStorage/__tests__/videoUploader.test.ts > cloudStorage videoUploader > should handle failures gracefully
[2026-01-05 13:56:25.477] [ERROR] [CloudStorage] Upload failed for Test Video: Error: Upload Failed
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/cloudStorage/__tests__/videoUploader.test.ts:117:62
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at runSuite [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

stdout | src/services/cloudStorage/__tests__/videoUploader.test.ts > cloudStorage videoUploader > should clear caches after update
[2026-01-05 13:56:25.479] [INFO] [CloudStorage] Starting upload for video: Test Video

stdout | src/services/cloudStorage/__tests__/videoUploader.test.ts > cloudStorage videoUploader > should clear caches after update
[2026-01-05 13:56:25.480] [INFO] [CloudStorage] Upload completed for: Test Video
[2026-01-05 13:56:25.480] [INFO] [CloudStorage] Deleting 2 local file(s) after successful upload...
[2026-01-05 13:56:25.480] [INFO] [CloudStorage] Deleted local file: /abs/videos/test.mp4
[2026-01-05 13:56:25.480] [INFO] [CloudStorage] Deleted local file: /abs/images/test.jpg
[2026-01-05 13:56:25.480] [INFO] [CloudStorage] Local file cleanup completed
[2026-01-05 13:56:25.480] [INFO] [CloudStorage] Updated video record video-123 with cloud storage indicators

 âœ“ src/services/cloudStorage/__tests__/videoUploader.test.ts (5 tests) 9ms
stdout | src/services/cloudStorage/__tests__/fileUploader.test.ts > cloudStorage fileUploader > uploadFile > should skip upload if file already exists in cloud
[2026-01-05 13:56:25.629] [INFO] [CloudStorage] File video.mp4 already exists in cloud storage with same size (1024 bytes), skipping upload

stdout | src/services/cloudStorage/__tests__/fileUploader.test.ts > cloudStorage fileUploader > uploadFile > should upload file successfully
[2026-01-05 13:56:25.630] [INFO] [CloudStorage] Uploading video.mp4 to /uploads/video.mp4 (1024 bytes)...
[2026-01-05 13:56:25.630] [DEBUG] [CloudStorage] Destination path in header: /uploads/video.mp4

stdout | src/services/cloudStorage/__tests__/fileUploader.test.ts > cloudStorage fileUploader > uploadFile > should upload file successfully
[2026-01-05 13:56:25.630] [INFO] [CloudStorage] Successfully uploaded video.mp4. Server message: Success

stdout | src/services/cloudStorage/__tests__/fileUploader.test.ts > cloudStorage fileUploader > uploadFile > should handle nested remote path
[2026-01-05 13:56:25.631] [INFO] [CloudStorage] Uploading video.mp4 to /uploads/subdir/video.mp4 (1024 bytes)...
[2026-01-05 13:56:25.631] [DEBUG] [CloudStorage] Destination path in header: /uploads/subdir/video.mp4

stdout | src/services/cloudStorage/__tests__/fileUploader.test.ts > cloudStorage fileUploader > uploadFile > should handle nested remote path
[2026-01-05 13:56:25.631] [INFO] [CloudStorage] Successfully uploaded video.mp4. Server message: Success

stdout | src/services/cloudStorage/__tests__/fileUploader.test.ts > cloudStorage fileUploader > uploadFile > should handle absolute remote path
[2026-01-05 13:56:25.632] [INFO] [CloudStorage] Uploading video.mp4 to /absolute/video.mp4 (1024 bytes)...
[2026-01-05 13:56:25.632] [DEBUG] [CloudStorage] Destination path in header: /absolute/video.mp4

stdout | src/services/cloudStorage/__tests__/fileUploader.test.ts > cloudStorage fileUploader > uploadFile > should handle absolute remote path
[2026-01-05 13:56:25.632] [INFO] [CloudStorage] Successfully uploaded video.mp4. Server message: Success

stdout | src/services/cloudStorage/__tests__/fileUploader.test.ts > cloudStorage fileUploader > uploadFile > should throw FileError on API failure (business error)
[2026-01-05 13:56:25.633] [INFO] [CloudStorage] Uploading video.mp4 to /uploads/video.mp4 (1024 bytes)...
[2026-01-05 13:56:25.633] [DEBUG] [CloudStorage] Destination path in header: /uploads/video.mp4

stderr | src/services/cloudStorage/__tests__/fileUploader.test.ts > cloudStorage fileUploader > uploadFile > should throw FileError on API failure (business error)
[2026-01-05 13:56:25.633] [ERROR] [CloudStorage] Upload Error: NetworkError: Upload failed on server: Internal Error (Code: 500)
    at NetworkError.withStatus [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/errors/DownloadErrors.ts:121:12[90m)[39m
    at Module.uploadFile [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/cloudStorage/fileUploader.ts:180:26[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/cloudStorage/__tests__/fileUploader.test.ts:123:13
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
  type: [32m'network'[39m,
  recoverable: [33mtrue[39m,
  statusCode: [33m200[39m
}

stdout | src/services/cloudStorage/__tests__/fileUploader.test.ts > cloudStorage fileUploader > uploadFile > should throw NetworkError on axios error
[2026-01-05 13:56:25.637] [INFO] [CloudStorage] Uploading video.mp4 to /uploads/video.mp4 (1024 bytes)...
[2026-01-05 13:56:25.637] [DEBUG] [CloudStorage] Destination path in header: /uploads/video.mp4

stderr | src/services/cloudStorage/__tests__/fileUploader.test.ts > cloudStorage fileUploader > uploadFile > should throw NetworkError on axios error
[2026-01-05 13:56:25.637] [ERROR] [CloudStorage] HTTP Error: 503 Error: "Service Unavailable"
    at Module.uploadFile [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/cloudStorage/fileUploader.ts:192:9[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/cloudStorage/__tests__/fileUploader.test.ts:131:13
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

 âœ“ src/services/cloudStorage/__tests__/fileUploader.test.ts (7 tests) 11ms
 âœ“ src/__tests__/services/continuousDownload/taskProcessor.test.ts (5 tests) 1015ms
   âœ“ TaskProcessor > should initialize total videos and process all urls for non-incremental task  1005ms
stdout | src/__tests__/utils/cleanupVideoArtifacts.test.ts > cleanupVideoArtifacts > should remove intermediate format files (.f137.mp4)
Deleted artifact file: /Users/franklioxygen/Projects/mytube/backend/src/__tests__/utils/temp_cleanup_artifacts_test/video_123.f137.mp4

stderr | src/__tests__/controllers/settingsController.test.ts > SettingsController > deleteLegacyData > should handle errors during deletion
[2026-01-05 13:56:25.866] [ERROR] Failed to delete /Users/franklioxygen/Projects/mytube/backend/data/videos.json: Error: Delete failed
    at Object.<anonymous> [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/controllers/settingsController.test.ts:167:15[90m)[39m
    at Object.mockCall [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:96:15[90m)[39m
    at Object.unlinkSync [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4mtinyspy[24m/dist/index.js:47:80[90m)[39m
    at Module.deleteLegacyData [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/controllers/settingsController.ts:86:12[90m)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/controllers/settingsController.test.ts:170:13
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
[2026-01-05 13:56:25.869] [ERROR] Failed to delete /Users/franklioxygen/Projects/mytube/backend/data/collections.json: Error: Delete failed
    at Object.<anonymous> [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/controllers/settingsController.test.ts:167:15[90m)[39m
    at Object.mockCall [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:96:15[90m)[39m
    at Object.unlinkSync [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4mtinyspy[24m/dist/index.js:47:80[90m)[39m
    at Module.deleteLegacyData [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/controllers/settingsController.ts:86:12[90m)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/controllers/settingsController.test.ts:170:13
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
[2026-01-05 13:56:25.870] [ERROR] Failed to delete /Users/franklioxygen/Projects/mytube/backend/data/status.json: Error: Delete failed
    at Object.<anonymous> [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/controllers/settingsController.test.ts:167:15[90m)[39m
    at Object.mockCall [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:96:15[90m)[39m
    at Object.unlinkSync [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4mtinyspy[24m/dist/index.js:47:80[90m)[39m
    at Module.deleteLegacyData [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/controllers/settingsController.ts:86:12[90m)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/controllers/settingsController.test.ts:170:13
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
[2026-01-05 13:56:25.870] [ERROR] Failed to delete /Users/franklioxygen/Projects/mytube/backend/data/settings.json: Error: Delete failed
    at Object.<anonymous> [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/controllers/settingsController.test.ts:167:15[90m)[39m
    at Object.mockCall [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:96:15[90m)[39m
    at Object.unlinkSync [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4mtinyspy[24m/dist/index.js:47:80[90m)[39m
    at Module.deleteLegacyData [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/controllers/settingsController.ts:86:12[90m)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/controllers/settingsController.test.ts:170:13
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m

 âœ“ src/__tests__/controllers/settingsController.test.ts (11 tests) 12ms
 âœ“ src/services/storageService/__tests__/videos.test.ts (6 tests) 6ms
 âœ“ src/__tests__/services/cookieService.test.ts (6 tests) 4ms
stdout | src/__tests__/controllers/scanController.test.ts > ScanController > scanFiles > should scan files and add new videos
[2026-01-05 13:56:25.997] [INFO] Starting file scan...
[2026-01-05 13:56:25.998] [INFO] Deleted 0 missing videos.
[2026-01-05 13:56:25.999] [INFO] Found new video file: video.mp4

stderr | src/__tests__/controllers/scanController.test.ts > ScanController > scanFiles > should scan files and add new videos
[2026-01-05 13:56:25.999] [ERROR] Error getting duration: TypeError: Cannot read properties of undefined (reading 'trim')
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/controllers/scanController.ts:185:30
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/controllers/scanController.test.ts:38:93
    at mockCall [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:96:15[90m)[39m
    at exec [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4mtinyspy[24m/dist/index.js:47:80[90m)[39m
    at durationOutput [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/controllers/scanController.ts:179:9[90m)[39m
    at new Promise (<anonymous>)
    at Module.scanFiles [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/controllers/scanController.ts:178:36[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/controllers/scanController.test.ts:40:7
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20
[2026-01-05 13:56:26.003] [WARN] Target filename already exists: video-Admin-2026.mp4, keeping original filename
[2026-01-05 13:56:26.003] [WARN] Thumbnail filename already exists: video-Admin-2026.jpg, using existing

stdout | src/__tests__/controllers/scanController.test.ts > ScanController > scanFiles > should scan files and add new videos
[2026-01-05 13:56:26.003] [INFO] Scan complete. Added 1 new videos. Deleted 0 missing videos.

stdout | src/__tests__/controllers/scanController.test.ts > ScanController > scanFiles > should handle errors
[2026-01-05 13:56:26.005] [INFO] Starting file scan...

 âœ“ src/__tests__/controllers/scanController.test.ts (2 tests) 9ms
 âœ“ src/__tests__/services/passwordService.test.ts (8 tests) 7ms
stdout | src/__tests__/services/thumbnailService.test.ts > ThumbnailService > moveAllThumbnails > should move thumbnails to video folders
Starting to move all thumbnails. Target: Video Folders
Finished moving thumbnails. Moved: 1, Errors: 0

stdout | src/__tests__/services/thumbnailService.test.ts > ThumbnailService > moveAllThumbnails > should move thumbnails to central images folder
Starting to move all thumbnails. Target: Central Images Folder
Finished moving thumbnails. Moved: 1, Errors: 0

stdout | src/__tests__/services/thumbnailService.test.ts > ThumbnailService > moveAllThumbnails > should handle videos in collection folders
Starting to move all thumbnails. Target: Video Folders
Finished moving thumbnails. Moved: 1, Errors: 0

stdout | src/__tests__/services/thumbnailService.test.ts > ThumbnailService > moveAllThumbnails > should skip videos without thumbnails
Starting to move all thumbnails. Target: Video Folders
Finished moving thumbnails. Moved: 0, Errors: 0

stdout | src/__tests__/services/thumbnailService.test.ts > ThumbnailService > moveAllThumbnails > should handle missing thumbnail files gracefully
Starting to move all thumbnails. Target: Video Folders
Finished moving thumbnails. Moved: 0, Errors: 0

stdout | src/__tests__/services/thumbnailService.test.ts > ThumbnailService > moveAllThumbnails > should handle errors during move
Starting to move all thumbnails. Target: Video Folders
Finished moving thumbnails. Moved: 0, Errors: 1

stderr | src/__tests__/services/thumbnailService.test.ts > ThumbnailService > moveAllThumbnails > should handle errors during move
Failed to move thumbnail thumb1.jpg: Error: Move failed
    at Object.<anonymous> [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/services/thumbnailService.test.ts:182:15[90m)[39m
    at Object.mockCall [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:96:15[90m)[39m
    at Object.moveSync [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4mtinyspy[24m/dist/index.js:47:80[90m)[39m
    at Module.moveAllThumbnails [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/thumbnailService.ts:102:20[90m)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/services/thumbnailService.test.ts:185:28
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m

stdout | src/__tests__/services/thumbnailService.test.ts > ThumbnailService > moveAllThumbnails > should not move if already in correct location
Starting to move all thumbnails. Target: Video Folders
Finished moving thumbnails. Moved: 0, Errors: 0

stdout | src/__tests__/services/thumbnailService.test.ts > ThumbnailService > moveAllThumbnails > should update path even if file already in correct location but path is wrong
Starting to move all thumbnails. Target: Video Folders
Finished moving thumbnails. Moved: 0, Errors: 0

stdout | src/__tests__/services/thumbnailService.test.ts > ThumbnailService > moveAllThumbnails > should handle videos with collection fallback
Starting to move all thumbnails. Target: Video Folders
Finished moving thumbnails. Moved: 1, Errors: 0

 âœ“ src/__tests__/services/thumbnailService.test.ts (9 tests) 27ms
 âœ“ src/__tests__/controllers/cookieController.test.ts (4 tests) 4ms
stderr | src/__tests__/services/subscriptionService.test.ts > SubscriptionService > subscribe > should subscribe to a YouTube channel
[2026-01-05 13:56:26.164] [ERROR] Error fetching YouTube channel info: Error: yt-dlp process exited with code 1
    at ChildProcess.<anonymous> [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/utils/ytDlpUtils.ts:225:23[90m)[39m
[90m    at ChildProcess.emit (node:events:508:28)[39m
[90m    at maybeClose (node:internal/child_process:1085:16)[39m
[90m    at Socket.<anonymous> (node:internal/child_process:456:11)[39m
[90m    at Socket.emit (node:events:508:28)[39m
[90m    at Pipe.<anonymous> (node:net:346:12)[39m {
  stderr: [32m'ERROR: [youtube:tab] @testuser: This channel does not have a videos tab\n'[39m
}

stdout | src/__tests__/services/subscriptionService.test.ts > SubscriptionService > subscribe > should throw DuplicateError if already subscribed
Executing: yt-dlp --dump-single-json --no-warnings --no-warnings --flat-playlist --playlist-end 1 --cookies /Users/franklioxygen/Projects/mytube/backend/data/cookies.txt --js-runtime node https://www.youtube.com/@testuser/videos

stderr | src/__tests__/services/subscriptionService.test.ts > SubscriptionService > subscribe > should throw DuplicateError if already subscribed
Error reading user yt-dlp config: TypeError: Cannot read properties of undefined (reading 'ytDlpConfig')
    at getUserYtDlpConfig [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/utils/ytDlpUtils.ts:426:33[90m)[39m
    at SubscriptionService.subscribe [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/subscriptionService.ts:85:30[90m)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/services/subscriptionService.test.ts:119:7
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

 âœ“ src/services/storageService/__tests__/collectionRepository.test.ts (6 tests) 5ms
stdout | src/__tests__/utils/cleanupVideoArtifacts.test.ts > cleanupVideoArtifacts > should remove partial files with intermediate formats (.f137.mp4.part)
Deleted artifact file: /Users/franklioxygen/Projects/mytube/backend/src/__tests__/utils/temp_cleanup_artifacts_test/video_123.f137.mp4.part

 âœ“ src/config/__tests__/paths.test.ts (1 test) 5ms
 âœ“ src/errors/__tests__/DownloadErrors.test.ts (25 tests) 3ms
 âœ“ src/services/__tests__/passkeyService.test.ts (11 tests) 6ms
 âœ“ src/__tests__/services/continuousDownload/videoUrlFetcher.test.ts (11 tests) 10ms
stdout | src/services/cloudStorage/__tests__/cloudScanner.test.ts > cloudStorage cloudScanner > should scan files and add new videos
[2026-01-05 13:56:26.559] [INFO] [CloudStorage] Starting cloud file scan...
[2026-01-05 13:56:26.560] [INFO] [CloudStorage] Scanning 2 path(s): /uploads, /movies
[2026-01-05 13:56:26.560] [INFO] [CloudStorage] Scanning path: /uploads

stdout | src/services/cloudStorage/__tests__/cloudScanner.test.ts > cloudStorage cloudScanner > should scan files and add new videos
[2026-01-05 13:56:26.560] [INFO] [CloudStorage] Found 2 files in /uploads
[2026-01-05 13:56:26.560] [INFO] [CloudStorage] Scanning path: /movies

stdout | src/services/cloudStorage/__tests__/cloudScanner.test.ts > cloudStorage cloudScanner > should scan files and add new videos
[2026-01-05 13:56:26.560] [INFO] [CloudStorage] Found 0 files in /movies
[2026-01-05 13:56:26.560] [INFO] [CloudStorage] Found 2 video files in cloud storage
[2026-01-05 13:56:26.560] [INFO] [CloudStorage] Found 1 new videos to add to database

stdout | src/services/cloudStorage/__tests__/cloudScanner.test.ts > cloudStorage cloudScanner > should scan files and add new videos
[2026-01-05 13:56:26.561] [DEBUG] [CloudStorage] Generating thumbnail at middle point (00:01:00) for new_video.mp4 (duration: 120.5s)
[2026-01-05 13:56:26.561] [DEBUG] [CloudStorage] Generating thumbnail for new_video.mp4 (attempt 1/3)

stdout | src/services/cloudStorage/__tests__/cloudScanner.test.ts > cloudStorage cloudScanner > should scan files and add new videos
[2026-01-05 13:56:26.561] [DEBUG] [CloudStorage] Successfully generated thumbnail for new_video.mp4 (1024 bytes)

stdout | src/services/cloudStorage/__tests__/cloudScanner.test.ts > cloudStorage cloudScanner > should scan files and add new videos
[2026-01-05 13:56:26.561] [INFO] [CloudStorage] Added video to database: new_video (/uploads/new_video.mp4)

stdout | src/services/cloudStorage/__tests__/cloudScanner.test.ts > cloudStorage cloudScanner > should scan files and add new videos
[2026-01-05 13:56:26.561] [INFO] [CloudStorage] Cloud scan completed: 1 added, 0 errors

stdout | src/services/cloudStorage/__tests__/cloudScanner.test.ts > cloudStorage cloudScanner > should ignore non-video files
[2026-01-05 13:56:26.564] [INFO] [CloudStorage] Starting cloud file scan...
[2026-01-05 13:56:26.564] [INFO] [CloudStorage] Scanning 2 path(s): /uploads, /movies
[2026-01-05 13:56:26.564] [INFO] [CloudStorage] Scanning path: /uploads

stdout | src/services/cloudStorage/__tests__/cloudScanner.test.ts > cloudStorage cloudScanner > should ignore non-video files
[2026-01-05 13:56:26.564] [INFO] [CloudStorage] Found 1 files in /uploads
[2026-01-05 13:56:26.564] [INFO] [CloudStorage] Scanning path: /movies

stdout | src/services/cloudStorage/__tests__/cloudScanner.test.ts > cloudStorage cloudScanner > should ignore non-video files
[2026-01-05 13:56:26.564] [INFO] [CloudStorage] Found 1 files in /movies
[2026-01-05 13:56:26.564] [INFO] [CloudStorage] Found 0 video files in cloud storage
[2026-01-05 13:56:26.564] [INFO] [CloudStorage] Found 0 new videos to add to database

stdout | src/services/cloudStorage/__tests__/cloudScanner.test.ts > cloudStorage cloudScanner > should ignore non-video files
[2026-01-05 13:56:26.564] [INFO] [CloudStorage] Cloud scan completed: 0 added, 0 errors

stdout | src/services/cloudStorage/__tests__/cloudScanner.test.ts > cloudStorage cloudScanner > should handle failure in video processing gracefully
[2026-01-05 13:56:26.564] [INFO] [CloudStorage] Starting cloud file scan...
[2026-01-05 13:56:26.564] [INFO] [CloudStorage] Scanning 2 path(s): /uploads, /movies
[2026-01-05 13:56:26.564] [INFO] [CloudStorage] Scanning path: /uploads

stdout | src/services/cloudStorage/__tests__/cloudScanner.test.ts > cloudStorage cloudScanner > should handle failure in video processing gracefully
[2026-01-05 13:56:26.564] [INFO] [CloudStorage] Found 2 files in /uploads
[2026-01-05 13:56:26.564] [INFO] [CloudStorage] Scanning path: /movies

stdout | src/services/cloudStorage/__tests__/cloudScanner.test.ts > cloudStorage cloudScanner > should handle failure in video processing gracefully
[2026-01-05 13:56:26.564] [INFO] [CloudStorage] Found 0 files in /movies
[2026-01-05 13:56:26.564] [INFO] [CloudStorage] Found 2 video files in cloud storage
[2026-01-05 13:56:26.564] [INFO] [CloudStorage] Found 1 new videos to add to database

stderr | src/services/cloudStorage/__tests__/cloudScanner.test.ts > cloudStorage cloudScanner > should handle failure in video processing gracefully
[2026-01-05 13:56:26.564] [ERROR] [CloudStorage] Failed to get signed URL for new_video.mp4

stdout | src/services/cloudStorage/__tests__/cloudScanner.test.ts > cloudStorage cloudScanner > should handle failure in video processing gracefully
[2026-01-05 13:56:26.564] [INFO] [CloudStorage] Cloud scan completed: 0 added, 1 errors

stdout | src/services/cloudStorage/__tests__/cloudScanner.test.ts > cloudStorage cloudScanner > should generate thumbnail with correct time point
[2026-01-05 13:56:26.565] [INFO] [CloudStorage] Starting cloud file scan...
[2026-01-05 13:56:26.565] [INFO] [CloudStorage] Scanning 2 path(s): /uploads, /movies
[2026-01-05 13:56:26.565] [INFO] [CloudStorage] Scanning path: /uploads

stdout | src/services/cloudStorage/__tests__/cloudScanner.test.ts > cloudStorage cloudScanner > should generate thumbnail with correct time point
[2026-01-05 13:56:26.565] [INFO] [CloudStorage] Found 2 files in /uploads
[2026-01-05 13:56:26.565] [INFO] [CloudStorage] Scanning path: /movies

stdout | src/services/cloudStorage/__tests__/cloudScanner.test.ts > cloudStorage cloudScanner > should generate thumbnail with correct time point
[2026-01-05 13:56:26.565] [INFO] [CloudStorage] Found 0 files in /movies
[2026-01-05 13:56:26.565] [INFO] [CloudStorage] Found 2 video files in cloud storage
[2026-01-05 13:56:26.565] [INFO] [CloudStorage] Found 1 new videos to add to database

stdout | src/services/cloudStorage/__tests__/cloudScanner.test.ts > cloudStorage cloudScanner > should generate thumbnail with correct time point
[2026-01-05 13:56:26.565] [DEBUG] [CloudStorage] Generating thumbnail at middle point (00:30:30) for new_video.mp4 (duration: 3661s)
[2026-01-05 13:56:26.565] [DEBUG] [CloudStorage] Generating thumbnail for new_video.mp4 (attempt 1/3)

stdout | src/services/cloudStorage/__tests__/cloudScanner.test.ts > cloudStorage cloudScanner > should generate thumbnail with correct time point
[2026-01-05 13:56:26.565] [DEBUG] [CloudStorage] Successfully generated thumbnail for new_video.mp4 (1024 bytes)

stdout | src/services/cloudStorage/__tests__/cloudScanner.test.ts > cloudStorage cloudScanner > should generate thumbnail with correct time point
[2026-01-05 13:56:26.565] [INFO] [CloudStorage] Added video to database: new_video (/uploads/new_video.mp4)

stdout | src/services/cloudStorage/__tests__/cloudScanner.test.ts > cloudStorage cloudScanner > should generate thumbnail with correct time point
[2026-01-05 13:56:26.565] [INFO] [CloudStorage] Cloud scan completed: 1 added, 0 errors

 âœ“ src/services/cloudStorage/__tests__/cloudScanner.test.ts (4 tests) 8ms
stdout | src/__tests__/services/commentService.test.ts > CommentService > getComments > should return comments when video exists and youtube-dl succeeds
[CommentService] Fetching comments using yt-dlp for: https://youtube.com/watch?v=123

stderr | src/__tests__/services/commentService.test.ts > CommentService > getComments > should return empty array if video not found
Error fetching comments: NotFoundError: Video not found: non-existent
    at NotFoundError.video [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/errors/DownloadErrors.ts:280:12[90m)[39m
    at Module.getComments [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/commentService.ts:18:27[90m)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/services/commentService.test.ts:55:30
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m {
  type: [32m'not_found'[39m,
  recoverable: [33mfalse[39m,
  resource: [32m'Video'[39m,
  resourceId: [32m'non-existent'[39m
}

stdout | src/__tests__/services/commentService.test.ts > CommentService > getComments > should return empty array if youtube-dl fails
[CommentService] Fetching comments using yt-dlp for: https://youtube.com/watch?v=123

stderr | src/__tests__/services/commentService.test.ts > CommentService > getComments > should return empty array if youtube-dl fails
Error fetching comments with yt-dlp: Error: Download failed
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/services/commentService.test.ts:68:9
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at runSuite [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

stdout | src/__tests__/services/commentService.test.ts > CommentService > getComments > should return empty array if no comments in output
[CommentService] Fetching comments using yt-dlp for: https://youtube.com/watch?v=123

 âœ“ src/__tests__/services/commentService.test.ts (4 tests) 10ms
stdout | src/__tests__/utils/helpers.test.ts > Helpers > resolveShortUrl > should resolve shortened URL
Resolving shortened URL: https://b23.tv/example

stdout | src/__tests__/utils/helpers.test.ts > Helpers > resolveShortUrl > should resolve shortened URL
Resolved to: https://www.bilibili.com/video/BV1xx411c7mD

stdout | src/__tests__/utils/helpers.test.ts > Helpers > resolveShortUrl > should return original URL if resolution fails
Resolving shortened URL: https://b23.tv/fail

stderr | src/__tests__/utils/helpers.test.ts > Helpers > resolveShortUrl > should return original URL if resolution fails
Error resolving shortened URL: Network error

stdout | src/__tests__/utils/helpers.test.ts > Helpers > trimBilibiliUrl > should trim bilibili URL with BV ID
Trimmed Bilibili URL from "https://www.bilibili.com/video/BV1xx411c7mD?spm_id_from=333.999.0.0" to "https://www.bilibili.com/video/BV1xx411c7mD"

stdout | src/__tests__/utils/helpers.test.ts > Helpers > trimBilibiliUrl > should trim bilibili URL with av ID
Trimmed Bilibili URL from "https://www.bilibili.com/video/av123456?spm_id_from=333.999.0.0" to "https://www.bilibili.com/video/av123456"

stdout | src/__tests__/utils/helpers.test.ts > Helpers > trimBilibiliUrl > should remove query parameters if no video ID found
Trimmed Bilibili URL from "https://www.bilibili.com/read/cv123456?from=search" to "https://www.bilibili.com/read/cv123456"

 âœ“ src/__tests__/utils/helpers.test.ts (32 tests) 8ms
stdout | src/services/cloudStorage/__tests__/index.test.ts > cloudStorage index (Service Facade) > scanCloudFiles > should return empty result if not configured
[2026-01-05 13:56:26.814] [INFO] [CloudStorage] Cloud storage not configured, skipping scan

 âœ“ src/services/cloudStorage/__tests__/index.test.ts (8 tests) 4ms
stdout | src/__tests__/utils/cleanupVideoArtifacts.test.ts > cleanupVideoArtifacts > should remove temp files (.temp.mp4)
Deleted artifact file: /Users/franklioxygen/Projects/mytube/backend/src/__tests__/utils/temp_cleanup_artifacts_test/video_123.temp.mp4

 âœ“ src/__tests__/utils/cleanupVideoArtifacts.test.ts (6 tests) 2567ms
   âœ“ cleanupVideoArtifacts > should remove .part files  532ms
   âœ“ cleanupVideoArtifacts > should remove .ytdl files  510ms
   âœ“ cleanupVideoArtifacts > should remove intermediate format files (.f137.mp4)  504ms
   âœ“ cleanupVideoArtifacts > should remove partial files with intermediate formats (.f137.mp4.part)  511ms
   âœ“ cleanupVideoArtifacts > should remove temp files (.temp.mp4)  505ms
stdout | src/__tests__/services/metadataService.test.ts > metadataService > backfillDurations > should update videos with missing durations
Starting duration backfill...

stdout | src/__tests__/services/metadataService.test.ts > metadataService > backfillDurations > should update videos with missing durations
Found 1 videos to check for duration.

stdout | src/__tests__/services/metadataService.test.ts > metadataService > backfillDurations > should update videos with missing durations
Updated duration for Vid 1: 101s
Duration backfill finished. Updated 1 videos.

 âœ“ src/__tests__/services/metadataService.test.ts (3 tests) 4ms
stdout | src/__tests__/services/continuousDownload/taskCleanup.test.ts > TaskCleanup > cleanupCurrentVideoTempFiles > should cleanup temp files for current video url
[INFO] Cleaning up temp files for current video: url1

stdout | src/__tests__/services/continuousDownload/taskCleanup.test.ts > TaskCleanup > cleanupCurrentVideoTempFiles > should cancel active download if matches current video
[INFO] Cleaning up temp files for current video: url1

stdout | src/__tests__/services/continuousDownload/taskCleanup.test.ts > TaskCleanup > cleanupCurrentVideoTempFiles > should cancel active download if matches current video
[INFO] Cancelling active download dl-1 for video url1

stderr | src/__tests__/services/continuousDownload/taskCleanup.test.ts > TaskCleanup > cleanupCurrentVideoTempFiles > should handle errors gracefully
[ERROR] Error in cleanupCurrentVideoTempFiles for task task-1: Error: Fetch failed
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/services/continuousDownload/taskCleanup.test.ts:160:9
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at runSuite [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

 âœ“ src/__tests__/services/continuousDownload/taskCleanup.test.ts (4 tests) 11ms
stderr | src/__tests__/services/subscriptionService.test.ts > SubscriptionService > subscribe > should throw DuplicateError if already subscribed
[2026-01-05 13:56:27.081] [ERROR] Error fetching YouTube channel info: Error: yt-dlp process exited with code 1
    at ChildProcess.<anonymous> [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/utils/ytDlpUtils.ts:225:23[90m)[39m
[90m    at ChildProcess.emit (node:events:508:28)[39m
[90m    at maybeClose (node:internal/child_process:1085:16)[39m
[90m    at Socket.<anonymous> (node:internal/child_process:456:11)[39m
[90m    at Socket.emit (node:events:508:28)[39m
[90m    at Pipe.<anonymous> (node:net:346:12)[39m {
  stderr: [32m'ERROR: [youtube:tab] @testuser: This channel does not have a videos tab\n'[39m
}

stdout | src/__tests__/services/subscriptionService.test.ts > SubscriptionService > unsubscribe > should unsubscribe successfully
[2026-01-05 13:56:27.083] [INFO] Unsubscribing from User (YouTube) - ID: sub-1

stdout | src/__tests__/services/subscriptionService.test.ts > SubscriptionService > unsubscribe > should unsubscribe successfully
[2026-01-05 13:56:27.083] [INFO] Successfully unsubscribed from User (YouTube)

stderr | src/__tests__/services/subscriptionService.test.ts > SubscriptionService > unsubscribe > should handle non-existent subscription gracefully
[2026-01-05 13:56:27.083] [WARN] Attempted to unsubscribe non-existent subscription: non-existent

stdout | src/__tests__/services/subscriptionService.test.ts > SubscriptionService > checkSubscriptions > should check subscriptions and download new video
Checking subscription for User (YouTube)...

stdout | src/__tests__/services/subscriptionService.test.ts > SubscriptionService > checkSubscriptions > should check subscriptions and download new video
New video found for User: new-link

stderr | src/__tests__/services/subscriptionService.test.ts > SubscriptionService > checkSubscriptions > should check subscriptions and download new video
Error downloading subscription video for User: TypeError: Cannot read properties of undefined (reading 'length')
    at SubscriptionService.checkSubscriptions [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/subscriptionService.ts:430:32[90m)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/services/subscriptionService.test.ts:204:7
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

stdout | src/__tests__/services/subscriptionService.test.ts > SubscriptionService > checkSubscriptions > should skip if no new video
Checking subscription for User (YouTube)...

stderr | src/__tests__/services/subscriptionService.test.ts > SubscriptionService > checkSubscriptions > should skip if no new video
Error checking subscription for User: TypeError: Cannot read properties of undefined (reading 'length')
    at SubscriptionService.checkSubscriptions [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/subscriptionService.ts:481:30[90m)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/services/subscriptionService.test.ts:235:7
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

 âœ“ src/__tests__/services/subscriptionService.test.ts (8 tests) 2353ms
   âœ“ SubscriptionService > subscribe > should subscribe to a YouTube channel  1433ms
   âœ“ SubscriptionService > subscribe > should throw DuplicateError if already subscribed  915ms
 âœ“ src/__tests__/controllers/passwordController.test.ts (5 tests) 4ms
stdout | src/services/cloudStorage/__tests__/pathUtils.test.ts > cloudStorage pathUtils > resolveAbsolutePath > should find video file in uploads directory
[2026-01-05 13:56:27.129] [DEBUG] resolveAbsolutePath input: videos/test.mp4
[2026-01-05 13:56:27.129] [DEBUG] cleanRelative: videos/test.mp4
[2026-01-05 13:56:27.130] [DEBUG] uploadsBase: /app/uploads
[2026-01-05 13:56:27.130] [DEBUG] Trying uploads videos path: /app/uploads/videos/test.mp4
[2026-01-05 13:56:27.130] [DEBUG] Found video file at: /app/uploads/videos/test.mp4

stdout | src/services/cloudStorage/__tests__/pathUtils.test.ts > cloudStorage pathUtils > resolveAbsolutePath > should find image file in uploads directory
[2026-01-05 13:56:27.130] [DEBUG] resolveAbsolutePath input: images/test.jpg
[2026-01-05 13:56:27.130] [DEBUG] cleanRelative: images/test.jpg
[2026-01-05 13:56:27.130] [DEBUG] uploadsBase: /app/uploads
[2026-01-05 13:56:27.130] [DEBUG] Trying uploads images path: /app/uploads/images/test.jpg
[2026-01-05 13:56:27.130] [DEBUG] Found image file at: /app/uploads/images/test.jpg

stdout | src/services/cloudStorage/__tests__/pathUtils.test.ts > cloudStorage pathUtils > resolveAbsolutePath > should find subtitle file in uploads directory
[2026-01-05 13:56:27.131] [DEBUG] resolveAbsolutePath input: subtitles/test.vtt
[2026-01-05 13:56:27.131] [DEBUG] cleanRelative: subtitles/test.vtt
[2026-01-05 13:56:27.131] [DEBUG] uploadsBase: /app/uploads
[2026-01-05 13:56:27.131] [DEBUG] Trying uploads subtitles path: /app/uploads/subtitles/test.vtt
[2026-01-05 13:56:27.131] [DEBUG] Found subtitle file at: /app/uploads/subtitles/test.vtt

stdout | src/services/cloudStorage/__tests__/pathUtils.test.ts > cloudStorage pathUtils > resolveAbsolutePath > should handle leading slash
[2026-01-05 13:56:27.131] [DEBUG] resolveAbsolutePath input: /videos/test.mp4
[2026-01-05 13:56:27.131] [DEBUG] cleanRelative: videos/test.mp4
[2026-01-05 13:56:27.131] [DEBUG] uploadsBase: /app/uploads
[2026-01-05 13:56:27.131] [DEBUG] Trying uploads videos path: /app/uploads/videos/test.mp4
[2026-01-05 13:56:27.131] [DEBUG] Found video file at: /app/uploads/videos/test.mp4

stdout | src/services/cloudStorage/__tests__/pathUtils.test.ts > cloudStorage pathUtils > resolveAbsolutePath > should fallback to legacy data roots if not found in uploads
[2026-01-05 13:56:27.131] [DEBUG] resolveAbsolutePath input: old/path/file.txt
[2026-01-05 13:56:27.131] [DEBUG] cleanRelative: old/path/file.txt
[2026-01-05 13:56:27.131] [DEBUG] uploadsBase: /app/uploads
[2026-01-05 13:56:27.131] [DEBUG] Checking data root: /app/data
[2026-01-05 13:56:27.131] [DEBUG] Found data root directory, trying file: /app/data/old/path/file.txt
[2026-01-05 13:56:27.131] [DEBUG] Found file in data root: /app/data/old/path/file.txt

stdout | src/services/cloudStorage/__tests__/pathUtils.test.ts > cloudStorage pathUtils > resolveAbsolutePath > should return null if not found anywhere
[2026-01-05 13:56:27.132] [DEBUG] resolveAbsolutePath input: nonexistent.file
[2026-01-05 13:56:27.132] [DEBUG] cleanRelative: nonexistent.file
[2026-01-05 13:56:27.132] [DEBUG] uploadsBase: /app/uploads
[2026-01-05 13:56:27.132] [DEBUG] Checking data root: /app/data
[2026-01-05 13:56:27.132] [DEBUG] Data root does not exist: /app/data
[2026-01-05 13:56:27.132] [DEBUG] Checking data root: /data
[2026-01-05 13:56:27.132] [DEBUG] Data root does not exist: /data
[2026-01-05 13:56:27.132] [DEBUG] Checking data root: /Users/franklioxygen/Projects/mytube/backend/data
[2026-01-05 13:56:27.132] [DEBUG] Data root does not exist: /Users/franklioxygen/Projects/mytube/backend/data
[2026-01-05 13:56:27.132] [DEBUG] No matching absolute path found for: nonexistent.file

 âœ“ src/services/cloudStorage/__tests__/pathUtils.test.ts (10 tests) 5ms
stdout | src/__tests__/services/migrationService.test.ts > migrationService > runMigration > should run without error
Starting migration...
Migration finished successfully.

stderr | src/__tests__/services/migrationService.test.ts > migrationService > runMigration > should run without error
Error migrating settings: TypeError: __vite_ssr_import_0__.default.readJSONSync is not a function
    at Module.runMigration [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/migrationService.ts:183:31[90m)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/services/migrationService.test.ts:33:43
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at runSuite [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
Error migrating status: TypeError: __vite_ssr_import_0__.default.readJSONSync is not a function
    at Module.runMigration [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/services/migrationService.ts:211:29[90m)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/services/migrationService.test.ts:33:43
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at runSuite [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

 âœ“ src/__tests__/services/migrationService.test.ts (1 test) 9ms
stderr | src/__tests__/utils/bccToVtt.test.ts > bccToVtt > should return empty string for invalid JSON string
Failed to parse BCC content SyntaxError: Unexpected token 'o', "not valid json" is not valid JSON
    at JSON.parse (<anonymous>)
    at bccToVtt [90m(/Users/franklioxygen/Projects/mytube/backend/[39msrc/utils/bccToVtt.ts:40:24[90m)[39m
    at [90m/Users/franklioxygen/Projects/mytube/backend/[39msrc/__tests__/utils/bccToVtt.test.ts:120:20
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/franklioxygen/Projects/mytube/backend/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m

 âœ“ src/__tests__/utils/bccToVtt.test.ts (9 tests) 6ms
 âœ“ src/__tests__/services/cloudflaredService.test.ts (6 tests) 4ms
stdout | src/services/cloudStorage/__tests__/urlSigner.test.ts > cloudStorage urlSigner > getSignedUrl > should return null if file not found
[2026-01-05 13:56:27.439] [DEBUG] [CloudStorage] Cleared all signed URL caches

stdout | src/services/cloudStorage/__tests__/urlSigner.test.ts > cloudStorage urlSigner > getSignedUrl > should return signed URL for video found in upload path
[2026-01-05 13:56:27.440] [DEBUG] [CloudStorage] Cleared all signed URL caches

stdout | src/services/cloudStorage/__tests__/urlSigner.test.ts > cloudStorage urlSigner > getSignedUrl > should return signed URL for video found in upload path
[2026-01-05 13:56:27.441] [DEBUG] [CloudStorage] Cached signed URL for video.mp4 (video)

stdout | src/services/cloudStorage/__tests__/urlSigner.test.ts > cloudStorage urlSigner > getSignedUrl > should return cached URL if available and valid
[2026-01-05 13:56:27.441] [DEBUG] [CloudStorage] Cleared all signed URL caches

stdout | src/services/cloudStorage/__tests__/urlSigner.test.ts > cloudStorage urlSigner > getSignedUrl > should return cached URL if available and valid
[2026-01-05 13:56:27.442] [DEBUG] [CloudStorage] Cached signed URL for video.mp4 (video)

stdout | src/services/cloudStorage/__tests__/urlSigner.test.ts > cloudStorage urlSigner > getSignedUrl > should return cached URL if available and valid
[2026-01-05 13:56:27.442] [DEBUG] [CloudStorage] Using cached signed URL for video.mp4 (video)

stdout | src/services/cloudStorage/__tests__/urlSigner.test.ts > cloudStorage urlSigner > getSignedUrl > should clear cache and fetch new URL
[2026-01-05 13:56:27.442] [DEBUG] [CloudStorage] Cleared all signed URL caches

stdout | src/services/cloudStorage/__tests__/urlSigner.test.ts > cloudStorage urlSigner > getSignedUrl > should clear cache and fetch new URL
[2026-01-05 13:56:27.442] [DEBUG] [CloudStorage] Cached signed URL for video.mp4 (video)

stdout | src/services/cloudStorage/__tests__/urlSigner.test.ts > cloudStorage urlSigner > getSignedUrl > should clear cache and fetch new URL
[2026-01-05 13:56:27.442] [DEBUG] [CloudStorage] Cleared cache for video.mp4:video

stdout | src/services/cloudStorage/__tests__/urlSigner.test.ts > cloudStorage urlSigner > getSignedUrl > should clear cache and fetch new URL
[2026-01-05 13:56:27.442] [DEBUG] [CloudStorage] Cached signed URL for video.mp4 (video)

stdout | src/services/cloudStorage/__tests__/urlSigner.test.ts > cloudStorage urlSigner > getSignedUrl > should handle file with directory path
[2026-01-05 13:56:27.442] [DEBUG] [CloudStorage] Cleared all signed URL caches

stdout | src/services/cloudStorage/__tests__/urlSigner.test.ts > cloudStorage urlSigner > getSignedUrl > should handle file with directory path
[2026-01-05 13:56:27.442] [DEBUG] [CloudStorage] Cached signed URL for movies/movie.mp4 (video)

stdout | src/services/cloudStorage/__tests__/urlSigner.test.ts > cloudStorage urlSigner > getSignedUrl > should search recursively if directory is "." (filename only)
[2026-01-05 13:56:27.442] [DEBUG] [CloudStorage] Cleared all signed URL caches

stdout | src/services/cloudStorage/__tests__/urlSigner.test.ts > cloudStorage urlSigner > getSignedUrl > should search recursively if directory is "." (filename only)
[2026-01-05 13:56:27.442] [DEBUG] [CloudStorage] Cached signed URL for nested.mp4 (video)

stdout | src/services/cloudStorage/__tests__/urlSigner.test.ts > cloudStorage urlSigner > getSignedUrl > should get thumbnail URL with sign preference
[2026-01-05 13:56:27.442] [DEBUG] [CloudStorage] Cleared all signed URL caches

stdout | src/services/cloudStorage/__tests__/urlSigner.test.ts > cloudStorage urlSigner > getSignedUrl > should get thumbnail URL with sign preference
[2026-01-05 13:56:27.443] [DEBUG] [CloudStorage] Cached signed URL for thumb.jpg (thumbnail)

stdout | src/services/cloudStorage/__tests__/urlSigner.test.ts > cloudStorage urlSigner > getSignedUrl > should fallback to thumb property if sign is missing
[2026-01-05 13:56:27.443] [DEBUG] [CloudStorage] Cleared all signed URL caches

stdout | src/services/cloudStorage/__tests__/urlSigner.test.ts > cloudStorage urlSigner > getSignedUrl > should fallback to thumb property if sign is missing
[2026-01-05 13:56:27.443] [DEBUG] [CloudStorage] Cached signed URL for thumb.jpg (thumbnail)

 âœ“ src/services/cloudStorage/__tests__/urlSigner.test.ts (8 tests) 5ms
 âœ“ src/__tests__/middleware/errorHandler.test.ts (12 tests) 6ms
 âœ“ src/__tests__/utils/downloadUtils.test.ts (5 tests) 3ms
 âœ“ src/__tests__/services/continuousDownload/taskRepository.test.ts (7 tests) 5ms
 âœ“ src/__tests__/controllers/downloadController.test.ts (7 tests) 3ms
 âœ“ src/__tests__/controllers/videoMetadataController.test.ts (5 tests) 6ms
 âœ“ src/__tests__/services/loginAttemptService.test.ts (4 tests) 3ms
 âœ“ src/__tests__/controllers/collectionController.test.ts (12 tests) 8ms
stdout | src/__tests__/services/downloaders/file_location.test.ts > File Location Logic > processSubtitles > should move subtitles to SUBTITLES_DIR by default
[2026-01-05 13:56:27.887] [INFO] Processing subtitles for video_123, move to video folder: false
[2026-01-05 13:56:27.888] [INFO] Found 1 subtitle files
[2026-01-05 13:56:27.888] [INFO] Processed and moved subtitle video_123.en.vtt to /mock/subtitles/video_123.en.vtt

stdout | src/__tests__/services/downloaders/file_location.test.ts > File Location Logic > processSubtitles > should keep subtitles in VIDEOS_DIR if moveSubtitlesToVideoFolder is true
[2026-01-05 13:56:27.889] [INFO] Processing subtitles for video_123, move to video folder: true
[2026-01-05 13:56:27.889] [INFO] Found 1 subtitle files
[2026-01-05 13:56:27.889] [INFO] Processed and moved subtitle video_123.en.vtt to /mock/videos/video_123.en.vtt

 âœ“ src/__tests__/services/downloaders/file_location.test.ts (2 tests) 3ms
 âœ“ src/__tests__/services/downloadService.test.ts (11 tests) 3ms
 âœ“ src/__tests__/services/databaseBackupService.test.ts (5 tests) 20ms
 âœ“ src/__tests__/utils/response.test.ts (5 tests) 4ms
 âœ“ src/__tests__/utils/progressTracker.test.ts (13 tests) 4ms
 âœ“ src/services/cloudStorage/__tests__/config.test.ts (9 tests) 7ms
 âœ“ src/__tests__/utils/logger.test.ts (3 tests) 3ms
 âœ“ src/services/__tests__/hookService.test.ts (3 tests) 2ms
 âœ“ src/controllers/__tests__/systemController.test.ts (5 tests) 5ms
 âœ“ src/services/storageService/__tests__/settings.test.ts (5 tests) 9ms
 âœ“ src/__tests__/controllers/cloudStorageController.test.ts (2 tests) 4ms
 âœ“ src/__tests__/controllers/videoDownloadController.test.ts (3 tests) 11ms
 âœ“ src/types/__tests__/settings.test.ts (2 tests) 2ms
 âœ“ src/services/storageService/__tests__/index.test.ts (2 tests) 1ms
Sourcemap for "/Users/franklioxygen/Projects/mytube/backend/node_modules/node-cron/dist/esm/node-cron.js" points to missing source files
 âœ“ src/__tests__/controllers/subscriptionController.test.ts (7 tests) 4ms
 âœ“ src/__tests__/utils/ytDlpUtils.test.ts (5 tests) 2ms
 âœ“ src/__tests__/services/settingsValidationService.test.ts (3 tests) 2ms
 âœ“ src/__tests__/services/downloaders/MissAVDownloader.urlSelection.test.ts (5 tests) 2ms
 âœ“ src/services/continuousDownload/__tests__/index.test.ts (1 test) 1ms

 Test Files  70 passed (70)
      Tests  517 passed (517)
   Start at  13:56:23
   Duration  5.80s (transform 1.74s, setup 0ms, collect 22.71s, tests 7.93s, environment 10ms, prepare 4.89s)

